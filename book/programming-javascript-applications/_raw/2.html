<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><script type="text/javascript">var NREUMQ=NREUMQ||[];NREUMQ.push(["mark","firstbyte",new Date().getTime()]);</script>
	<title>Programming JavaScript Applications</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/book-748da559db3e7bc457e1e4da3b2fa1e9.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/default-6b113e470a1a8ec83000e32a1548bc3a.css" media="screen" rel="stylesheet" type="text/css" />
	<script src="http://dwn0odqttrkhc.cloudfront.net/assets/application-984298d79dbc8412cdf579684d9338f6.js" type="text/javascript"></script>
	<script src="http://dwn0odqttrkhc.cloudfront.net/assets/book-756862b9ed04d945ca53de5b8f106a83.js" type="text/javascript"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/janrain-53eb5abed55992e21943b9d3373923e8.css" media="all" rel="stylesheet" type="text/css" />
	<meta content="authenticity_token" name="csrf-param" />
<meta content="vrhCbO3YGUtgpfcFNpDQsJTb1GEdABVLwPth603tUMs=" name="csrf-token" />
	<script type="text/javascript" charset="utf-8">
  	
		app.data = new classes.Data({"controller":{"controller":"books","action":"html"},"capturable":{"capture_server":"https://oreilly.janraincapture.com","client_id":"6n5q2k9vesqgn93k3mhevka6c3c3rsre","app_url":"https://login.oreilly.com","app_id":"xsnca5wmqe9vxv97ygh5vfejkd","load_js":"d16s8pqtk4uodx.cloudfront.net/login.oreilly.com/load.js"},"user":{"id":null,"account":"LoggedOutAccount","email":"","name":null,"gravatar_url":"http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&d=identicon"},"book":{"isbn":"1234000000262","chapter":"ch02.html","toc_url":"/books/1234000000262/toc_html","metadata_url":"http://d4bb7yl96lyl1.cloudfront.net/1234000000262/metadata/metadata_c6a0e8997c9604111d0171fb2d72f5c1b6cfd618.json"},"abilities":{"can_destroy_all_comments":false,"can_create_comments":false},"advertisement":{"body":"<style>      \r\n.ad-profile-image {\r\n  padding: 0;\r\n  margin: 0;\r\n  max-height: 30px;\r\n }\r\n\r\n.top-banner {\r\n  position: absolute;\r\n  right: 0;\r\n  top: 34px;\r\n  z-index: 99999;\r\n}\r\n\r\np.banner-text {\r\n  margin: 0;\r\n  text-align: center;\r\n  padding-right: 10px;\r\n  width: 500px;\r\n}\r\n\r\n@media screen and (max-width: 600px) {\r\n   p.banner-text {\r\n     width: 100%;\r\n     text-align: center;\r\n  }\r\n}\r\n\r\nspan.ebook-advantage {\r\n  font-size: smaller;\r\n  display: block;\r\n}\r\n\r\ndiv.banner-container {\r\n  margin: 0 auto;\r\n}\r\n\r\ndiv.banner-container ul {\r\n  margin: 0 auto;\r\n}\r\n\r\ndiv.topad { padding-bottom: 5px; }\r\n\r\ndiv.banner-container ul li {\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n}\r\n\r\ndiv.banner-container li p {\r\n  padding-top: 0;\r\n  margin-top: 0;\r\n}\r\n\r\ndiv.banner-container li.sponsor {\r\n  border-right: 1px solid rgb(125, 154, 180);\r\n  margin-right: 5px;\r\n  padding-right: 10px;\r\n}\r\n\r\ndiv.banner-container .webbutton {\r\n  background-color: #3994b6;\r\n  display: inline-block;\r\n  padding: 10px;\r\n  -webkit-border-radius: 5px;\r\n  -moz-border-radius: 5px;\r\n  border-radius: 5px;\r\n  color: #FFF;\r\n  text-align: center;\r\n  text-decoration: none;\r\n  font-size: 12px;\r\n  font-weight: bold;\r\n}\r\n\r\n</style>\r\n   \r\n<div style=\"color: rgb(125, 154, 180);\">\r\n\r\n<div class=\"banner-container\">\r\n\r\n<ul>\r\n\r\n<li class=\"sponsor\">\r\n<!--CONFERENCE SPONSOR IMAGE-->\r\n<a href=\"http://velocityconf.com/\">\r\n<img src=\"http://orm-other.s3.amazonaws.com/velocity_logo.png\" class=\"ad-profile-image\"/>\r\n<!-- <img src=\"http://orm-other.s3.amazonaws.com/fluent_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/oscon_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/strata_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/StrataRx_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/velocity_logo.png\" class=\"ad-profile-image\"/> -->\r\n</a>\r\n</li>\r\n\r\n<li>\r\n<!--AD TEXT, 2 LINES, REPLACE LINK URL AS WELL-->\r\n<p class=\"banner-text\">Enjoy this free Early Release version of <em>Programming JavaScript Applications</em>. Purchase and download the DRM-free ebook on <a href=\"http://shop.oreilly.com/product/0636920024231.do?intcmp=il-npa-books-video-product_chimera\">oreilly.com</a>.<span class=\"ebook-advantage\">Learn more about the O’Reilly <a href=\"http://shop.oreilly.com/category/ebooks.do\">Ebook Advantage</a>.</span></p>\r\n</li>\r\n\r\n<li>\r\n<!--BUY BUTTON-->\r\n<a class=\"webbutton\" href=\"http://shop.oreilly.com/product/0636920024231.do?intcmp=il-npa-books-video-product_chimera\">Buy the Ebook</a>\r\n</li> \r\n\r\n</ul>\r\n\r\n</div>\r\n\r\n<!--CORNER BANNER (IF NEEDED)-->\r\n<!--<a href=\"http://shop.oreilly.com/product/0636920025245.do\" class=\"top-banner\"><img src=\"http://orm-other.s3.amazonaws.com/banner.png\" /></a>-->\r\n\r\n</div>"}});

		/* Janrain setup */
  	var janrainModal = new JanrainView();
  	$("head").append(janrainModal.render().el);

  	/* segment.io setup */
  	var analytics=analytics||[];analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var r=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["identify","track","trackLink","trackForm","trackClick","trackSubmit","pageview","ab","alias","ready"];for(var s=0;s<i.length;s++)analytics[i[s]]=r(i[s])};
  	
  	analytics.load("hg9h6b9pae");

  	$(function() {
			app.bookapp = new BookApp();
		});
	
	</script>
</head>
<body>
	<div id="menu">
	
		<ul id="menu-left">
			<li id="home-link"><a href="/"><i class="icon-house"></i></a></li>
			<li><a href="/books/1234000000262">Programming JavaScript Applications</a></li>
			<div class="clear"></div>
		</ul>
	
		<ul id="menu-right">
			<li id="comments-link"><a>&nbsp;</a></li>
			<li>
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapters</a>
				<div id="toc-popup" class="dropdown-menu"></div>
			</li>
				<li><a href="#" class="capture_modal_open" id="capture_signin_link">Log In / Sign Up</a></li>
			<li id="search-li">
				<form accept-charset="UTF-8" action="/searches" id="search-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
	<input name='search[q]' type="text" placeholder="Search book..." id="book-search" />

	<input id="search_bookId" name="search[bookId]" type="hidden" value="1234000000262" />
	
	<div style='display:none'>
		sorted by: 
		<select name='search[sort]' >
			<option value='relevance'>Relevance</option>
			<option value='authors'>Author(s)</option>
			<option value='title'>Title</option>
		</select>
		returning
		<select name='search[limit]' >
			<option value='5'>5</option>
			<option value='10'>10</option>
			<option value='20'>20</option>
			<option selected="selected" value='50'>50</option>
			<option value='100'>100</option>
		</select>
		values at a time.
	</div>
</form>
			</li>
			<div class="clear"></div>
		</ul>
		<div class="clear"></div>
	
</div>
	<header><div class="navheader">
<table style="width: 100%; ">
<tr><td style="text-align: center; " colspan="3">Chapter 2. JavaScript Style Guide</td></tr>
<tr>
<td style="width: 20%; text-align: left; ">
<a accesskey="p" href="ch01.html">Prev</a> </td>
<td style="width: 60%; text-align: center; "> </td>
<td style="width: 20%; text-align: right; "> <a accesskey="n" href="ch03.html">Next</a>
</td>
</tr>
</table>
<hr>
</div></header><section class="chapter" data-original-filename="ch02.xml" id="javascript_style_guide"><div class="titlepage"><div><div><h1 class="title">Chapter 2. JavaScript Style Guide</h1></div></div></div>
<p id="you_dont_need_">You don't need to know the arcane inner workings of JavaScript in order to do lots of useful things with it. However, if you plan to write an application with tens of thousands of lines of code, you're going to need to explore a little deeper. In this chapter, we'll cover  some fundamentals that will help you build large apps that are still maintainable. For more on these subjects, I strongly recommend "JavaScript: The Good Parts" by Douglas Crockford, "JavaScript: The Definitive Guide" by David Flanagan, and "JavaScript Patterns".</p>
<div class="sect1" data-original-filename="ch02.xml" id="example_tests">
<div class="titlepage"><div><div><h2 class="title">Example Tests</h2></div></div></div>
<p id="this_book_is_ab">This book is about developing real world applications, and in the real world, applications are fragile. When you change them, things often break, and you need an easy way to detect those broken things so you can fix them before your users are impacted.</p>
<p id="manual_quality_">Manual quality assurance is an expensive, time consuming, and tedious process, and the larger your code base grows, the bigger the job gets. One commonly accepted solution to this problem is to write tests that assure your code does what you expect.</p>
<p id="tests_can_aid_i">Tests can aid in debugging as well. Frequently when a large number of components interact (often indirectly), it's difficult to tell which component a bug is hiding in. If you have a test suite, and one component breaks, you'll be alerted immediately which component isn't behaving the way it was designed to behave.</p>
<p id="throughout_this">Throughout this book you'll see <a class="ulink" href="http://docs.jquery.com/QUnit" target="_top">QUnit</a> tests in  examples to alert you to expected and actual behaviors. QUnit is a JavaScript unit test framework that generates clear, readable test output  on whatever page you include it in. It's the test suite used by <a class="ulink" href="http://jquery.com/" target="_top">jQuery</a>.</p>
<p id="it_is_safe_to_a">It is safe to assume that all tests pass, unless you see a comment that says otherwise. For example:</p>
<pre class="programlisting" data-language="js" id="var_highpass__"><code class="kd">var</code> <code class="nx">highPass</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">highPass</code><code class="p">(</code><code class="nx">number</code><code class="p">,</code> <code class="nx">cutoff</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">number</code> <code class="o">&gt;=</code> <code class="nx">cutoff</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
      <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">},</code>

  <code class="nx">lowPass</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">lowPass</code><code class="p">(</code><code class="nx">number</code><code class="p">,</code> <code class="nx">cutoff</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">number</code> <code class="o">&gt;=</code> <code class="nx">cutoff</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
      <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>

<code class="nx">module</code><code class="p">(</code><code class="s1">'Filter Examples'</code><code class="p">);</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'highPass'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">highPass</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">5</code><code class="p">),</code> <code class="s1">'Lower values should not pass.'</code><code class="p">);</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">highPass</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">5</code><code class="p">),</code> <code class="s1">'Higher values should pass.'</code><code class="p">);</code>
<code class="p">});</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'lowPass'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">lowPass</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">5</code><code class="p">),</code> <code class="s1">'Lower values should pass.'</code><code class="p">);</code> <code class="c1">// Fails</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">lowPass</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="mi">5</code><code class="p">),</code>
    <code class="s1">'Higher values should not pass.'</code><code class="p">);</code> <code class="c1">// Fails</code>
<code class="p">});</code></pre>
<p id="the_first_test_">The first test passes the tests as written. The second test set fails because the logic needs to be inverted in <code class="code">lowPass()</code>.</p>
<div class="sect2" id="qunit_primer">
<div class="titlepage"><div><div><h3 class="title">QUnit Primer</h3></div></div></div>
<p id="in_this_book_w">In this book, we'll be using several QUnit functions:</p>
<div class="itemizedlist" id="moduletesto"><ul class="itemizedlist">
<li class="listitem"><p id="module"><code class="code">module()</code></p></li>
<li class="listitem"><p id="test"><code class="code">test()</code></p></li>
<li class="listitem"><p id="ok"><code class="code">ok()</code></p></li>
<li class="listitem"><p id="equal"><code class="code">equal()</code></p></li>
</ul></div>
<p id="the_module_fu">The <code class="code">module()</code> function allows you to group related functionality in your test output. The <code class="code">name</code> parameter can be any string. Usage:</p>
<p id="modulename"><code class="code">module(<em class="replaceable"><code>'Name'</code></em>);</code></p>
<p id="the_test_func">The <code class="code">test()</code> function lets you name and define individual module tests. All assertions go inside tests. Usage:</p>
<pre class="programlisting" id="testname_fu">test(<em class="replaceable"><code>'Name'</code></em>, function () {
    <em class="replaceable"><code>// Your assertions here...</code></em>
});</pre>
<p id="you_can_test_th">You can test the truthiness of an expression with <code class="code">ok():</code></p>
<pre class="programlisting" id="oktrue_descr">ok(<em class="replaceable"><code>true</code></em>, <em class="replaceable"><code>'Description'</code></em>);</pre>
<p id="the_first_param">The first parameter can be any expression you wish to evaluate. If the expression is truthy, the assertion will pass. You can do anything you want with the Description, but I like to write them like: <em class="replaceable"><code>Subject</code></em> should <em class="replaceable"><code>verb</code></em>. For e.g., "User should exist.", "Valid input should pass", etc... If you find yourself writing "<em class="replaceable"><code>Subject</code></em> should <span class="emphasis"><em>be</em></span>...", consider using <code class="code">equal()</code>, instead.</p>
</div>
</div>
<div class="sect1" data-original-filename="ch02.xml" id="code_quality">
<div class="titlepage"><div><div><h2 class="title">Code Quality</h2></div></div></div>
<p id="when_you_approa">When you approach JavaScript for application development, style becomes more important than it is in the context of one-off scripts. Code is more readable if code style and conventions are used consistently. That's not to say that your style shouldn't evolve as you hone your skills: rather, it should converge on a set of standards that other developers can learn and use.</p>
<p id="some_style_choi">Some style choices are arbitrary, but many best practices have emerged in the JavaScript community. In this section we'll cover a few of the more important style considerations you should be aware of.</p>
<p id="perhaps_the_eas">Perhaps the easiest way to start converging on a code quality standard is to begin <em class="firstterm">linting</em> your code with a tool like <em class="firstterm">JSLint</em>. Linters scan your source code for syntax errors (and in the case of JSLint, some stylistic errors, as well).</p>
<p id="the_most_obviou">The most obvious reason to use a lint tool is that it can be an extremely valuable debugging asset. Most bugs are the result of syntax errors. If a tool can help you eliminate all syntax-related bugs from your code quickly, you'll see huge gains in productivity.</p>
<p id="a_few_of_the_st">A few of the style choices enforced in JSLint have raised controversy in the JavaScript community, but even if you don't agree with every point that the author,  <a class="ulink" href="http://www.crockford.com/" target="_top">Douglas Crockford</a> makes about JavaScript style, it's important to have a thorough understanding of why those choices were made.</p>
<p id="more_importantl">More importantly, using an automated tool like JSLint is the best way to enforce a minimum level of code quality and style throughout the code base. In my experience, getting all the developers on the same page is worth a little sacrifice in style.</p>
<p id="if_you_can_make">If you can make the trade offs, what you gain in increased productivity  is extraordinary. However, if you can't make one or two of the trade-offs prescribed by JSLint, there is a tool for you, as well: JSHint. In JSHint, the rules are more flexible.</p>
<div class="caution" id="think_carefully_id1"><p id="think_carefully_id2">Think carefully before choosing to ignore the recommendations of JSLint. While some of them may seem arbitrary at first, they're all there for a reason. Deviate at your own risk.</p></div>
<div class="sect2" id="best_practices_quick_reference">
<div class="titlepage"><div><div><h3 class="title">Best Practices Quick Reference</h3></div></div></div>
<div class="sect3" id="indentation__be_consistent">
<div class="titlepage"><div><div><h4 class="title">Indentation - Be Consistent</h4></div></div></div>
<p id="tabs_or_spaces">Tabs or Spaces? It's common for people to have very strong feelings, but both have their merits. Tab users say it saves them keystrokes, there are never any hidden whitespace characters, and tabs allow users to set their own indentation display preferences. Space users say that most editors will automatically substitute spaces for tabs, and support "soft tabs" that have similar display characteristics to tabs. And you can line up your code better with more fine-grained control of your whitespace.  All good points. Too close to call a clear winner.</p>
<p id="whats_importan">What's important is that you pick one and stick with it. If you're working as a team, all members of the team should use the same standard.</p>
</div>
<div class="sect3" id="use_semicolons">
<div class="titlepage"><div><div><h4 class="title">Use Semicolons</h4></div></div></div>
<p id="there_is_a_rece">There is a recent and growing movement in JavaScript circles to use a style that leaves off optional semicolons. When the JavaScript runtime encounters a condition where there should be a semicolon to make sense of the code, but can't find one, it inserts a semicolon automatically. This behavior is called Automatic Semicolon Insertion (ASI).</p>
<p id="the_new_style_d">The new style depends on ASI to produce valid JavaScript code for the engine to execute. In my opinion, this style should be avoided in the short term, but maybe embraced in the long term.</p>
<p id="the_problem_wit_id1">The problem with the new style is not in the style itself. Provided you follow a few simple rules, it is a readable and viable. Less syntax is sometimes more.</p>
<p id="the_problem_is_">The problem is that there are currently no automated lint tools that I am aware of which can ignore your missing semicolons when they're not required, but highlight the error cases where leaving out the semicolon will cause ambiguities that ASI can't resolve. Lint tools are highly valuable, and missing semicolons are among the most common sources of bugs. I can't recommend a style that would require you to abandon useful lint rules.</p>
<p id="whatever_you_do">Whatever you do, don't just leave all semicolons out. Sometimes, semicolons are required. The following tests all fail due to missing semicolons:</p>
<pre class="programlisting" data-language="js" id="testmissing_s"><code class="nx">test</code><code class="p">(</code><code class="s1">'Missing semicolon before +'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">a</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">+</code> <code class="mi">1</code>
  <code class="o">+</code><code class="s1">'3'</code><code class="p">;</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">a</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code>
    <code class="s1">'a should be 2.'</code>
  <code class="p">);</code> <code class="c1">// Fails. a = 23</code>
<code class="p">});</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Missing semicolon before ['</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">b</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">+</code> <code class="mi">1</code>
  <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">1</code><code class="p">].</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">num</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">b</code> <code class="o">+=</code> <code class="nx">num</code><code class="p">;</code>
  <code class="p">});</code>

  <code class="c1">// Error: Cannot call method forEach of undefined.</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">b</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code>
    <code class="s1">'b should be 4.'</code>
  <code class="p">);</code> 
<code class="p">});</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Missing semicolon before ('</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">1</code><code class="p">,</code>
    <code class="nx">f</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">f</code> <code class="p">()</code> <code class="p">{</code>
      <code class="nx">ok</code><code class="p">(</code><code class="kc">false</code><code class="p">,</code> <code class="s1">'This test should not run.'</code><code class="p">);</code> <code class="c1">// Fails.</code>
    <code class="p">}</code>

  <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="cm">/* Do something interesting. */</code>
  <code class="p">}());</code>
<code class="p">});</code></pre>
</div>
<div class="sect3" id="bracket_placement__right_side">
<div class="titlepage"><div><div><h4 class="title">Bracket Placement - Right Side</h4></div></div></div>
<p id="due_to_automati">Due to automatic semicolon insertion, brackets should always be placed to the right, on the line that begins the statement.</p>
<p id="wrong">Wrong:</p>
<pre class="programlisting" data-language="js" id="var_getlocation_id1"><code class="kd">var</code> <code class="nx">getLocation</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">getLocation</code><code class="p">()</code>
<code class="p">{</code>
  <code class="k">return</code>  
  <code class="p">{</code>
    <code class="nx">x</code><code class="o">:</code> <code class="mi">20</code><code class="p">,</code>
    <code class="nx">y</code><code class="o">:</code> <code class="mi">20</code>
  <code class="p">};</code>
<code class="p">};</code></pre>
<p id="right">Right:</p>
<pre class="programlisting" data-language="js" id="var_getlocation_id2"><code class="kd">var</code> <code class="nx">getLocation</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">getLocation</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code>  <code class="p">{</code>
    <code class="nx">x</code><code class="o">:</code> <code class="mi">20</code><code class="p">,</code>
    <code class="nx">y</code><code class="o">:</code> <code class="mi">20</code>
  <code class="p">};</code>
<code class="p">};</code></pre>
</div>
<div class="sect3" id="avoid_name_collisions">
<div class="titlepage"><div><div><h4 class="title">Avoid Name Collisions</h4></div></div></div>
<p id="the_default_sco">The default scope for variables in JavaScript is global. Every other script on the page has to share that namespace. In order to prevent name collisions, your application should use as few global names as possible. Typically, that would be a single name for the application, and possibly a handful of others for supporting libraries, such as jQuery and Underscore.</p>
<p id="wrong_x_is_glo_id1">Wrong: x is Global</p>
<pre class="programlisting" data-language="js" id="var_x__do_st"><code class="kd">var</code> <code class="nx">x</code><code class="p">;</code>
<code class="c1">// Do stuff with x...</code></pre>
<p id="right_x_is_loc">Right: x is Local to the Wrapping Function</p>
<pre class="programlisting" data-language="js" id="function_myscr_id1"><code class="p">(</code><code class="kd">function</code> <code class="nx">myScript</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">x</code><code class="p">;</code>
  <code class="c1">// Do stuff with x...</code>
<code class="p">}());</code></pre>
<p id="this_type_of_fu">This type of function wrapper is called an Immediately Invoked Function Expression (IIFE, pronounced "iffy"). For details, see the IIFE section.</p>
</div>
<div class="sect3" id="always_use_var">
<div class="titlepage"><div><div><h4 class="title">Always Use Var</h4></div></div></div>
<p id="if_you_forget_t">If you forget to use the <code class="code">var</code> keyword, your variable assignments will pollute the global scope.</p>
<p id="wrong_x_is_glo_id2">Wrong: x is Global</p>
<pre class="programlisting" data-language="js" id="var_add__funct_id1"><code class="kd">var</code> <code class="nx">add</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">x</code> <code class="o">=</code> <code class="mi">2</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">number</code> <code class="o">+</code> <code class="nx">x</code><code class="p">;</code>
<code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Without var.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">),</code> <code class="mi">4</code><code class="p">,</code>
    <code class="s1">'add() should add 2 to whatever you pass in.'</code>
  <code class="p">);</code>

  <code class="c1">// Fails</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">x</code><code class="p">,</code> <code class="s1">'x should not pollute the global scope.'</code><code class="p">);</code>
<code class="p">});</code></pre>
<p id="right_function">Right: Function Scope</p>
<pre class="programlisting" data-language="js" id="var_add__funct_id2"><code class="kd">var</code> <code class="nx">add</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">number</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">2</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">number</code> <code class="o">+</code> <code class="nx">x</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'With var.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">add</code><code class="p">(</code><code class="mi">2</code><code class="p">),</code> <code class="mi">4</code><code class="p">,</code>
    <code class="s1">'add() should add 2 to whatever you pass in.'</code>
  <code class="p">);</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">x</code><code class="p">,</code> <code class="s1">'x should not pollute the global scope.'</code><code class="p">);</code>
<code class="p">});</code></pre>
</div>
<div class="sect3" id="use_one_var_statement_per_function">
<div class="titlepage"><div><div><h4 class="title">Use One var Statement per Function</h4></div></div></div>
<p id="todo_link_to_id1">Because of the peculiarities with hoisting (see the sections on function and variable hoisting), you should only use one <code class="code">var</code> statement per function, at the top of your function.</p>
<p id="wrong_multiple">Wrong: Multiple var Statements</p>
<pre class="programlisting" data-language="js" id="function_myscr_id2"><code class="p">(</code><code class="kd">function</code> <code class="nx">myScript</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
  <code class="kd">var</code> <code class="nx">y</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
  <code class="cm">/* do some stuff with x and y */</code>
  <code class="kd">var</code> <code class="nx">z</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
  <code class="cm">/* do some stuff with z */</code>
<code class="p">}());</code></pre>
<p id="right_one_var_">Right: One <code class="code">var</code> per Function</p>
<pre class="programlisting" data-language="js" id="function_myscr_id3"><code class="p">(</code><code class="kd">function</code> <code class="nx">myScript</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="kc">true</code><code class="p">,</code>
    <code class="nx">y</code> <code class="o">=</code> <code class="kc">true</code><code class="p">,</code>
    <code class="nx">z</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
  <code class="cm">/* do some stuff with x, y, and z */</code>
<code class="p">}());</code></pre>
</div>
<div class="sect3" id="avoid_constants">
<div class="titlepage"><div><div><h4 class="title">Avoid Constants</h4></div></div></div>
<p id="constants_are_a">Constants are a class of types that allow you to specify names for values that never change. They're used to express things like mathematical constants (like pi), fixed ratios (the number of seconds in a minute), etc... If a constant is able to change, it will likely break the code that relies on it. It is for this reason that  in most languages, constants are immutable.</p>
<p id="that_is_not_the">That is not the case in JavaScript. There is a <code class="code">const</code> keyword coming to JavaScript, but it will likely be a few years before you can safely use it for cross-browser code. This hasn't stopped people from faking constants in JavaScript, however.</p>
<p id="todo_link_to_id2">The general convention is to use all caps to name constants. This convention is much older than JavaScript, and the well understood meaning is, "you can count on this value to never change, and to never need changing." Because you can't count on fake constants to be constant, it's probably better not to fake it at all. If you really need the value to be safe, store it in a closure and use a getter function to access it. (See the section on closures to learn more.)</p>
<p id="more_often_than_id1">More often than not in practice, I've seen fake constants abused for things that never should have been considered constant in the first place. It's very common to confuse constants and configuration.</p>
<p id="code_that_emplo">Code that employs constants instead of configuration tends to get more rigid and brittle as it grows. If you can't configure a module, the same code tends to get rewritten with few differences, except for variable names and a few differences in constant declarations.</p>
<p id="employing_confi">Employing configuration instead of constants allows you to re-use the code, instead of writing new code.</p>
<p id="wrong_abusing_">Wrong: Abusing constants</p>
<pre class="programlisting" data-language="js" id="var_createuserb"><code class="kd">var</code> <code class="nx">createUserBox</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">createUserBox</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">WIDTH</code> <code class="o">=</code> <code class="s1">'80px'</code><code class="p">,</code>
    <code class="nx">HEIGHT</code> <code class="o">=</code> <code class="s1">'80px'</code><code class="p">;</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">width</code><code class="o">:</code> <code class="nx">WIDTH</code><code class="p">,</code>
    <code class="nx">height</code><code class="o">:</code> <code class="nx">HEIGHT</code>
  <code class="p">};</code>
<code class="p">},</code>
<code class="nx">createMenuBox</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">createMenuBox</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">WIDTH</code> <code class="o">=</code> <code class="s1">'200px'</code><code class="p">,</code>
    <code class="nx">HEIGHT</code> <code class="o">=</code> <code class="s1">'400px'</code><code class="p">;</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">width</code><code class="o">:</code> <code class="nx">WIDTH</code><code class="p">,</code>
    <code class="nx">height</code><code class="o">:</code> <code class="nx">HEIGHT</code>
  <code class="p">};</code>
<code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Avoid Constants'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">userBox</code> <code class="o">=</code> <code class="nx">createUserBox</code><code class="p">(),</code>
    <code class="nx">menuBox</code> <code class="o">=</code> <code class="nx">createMenuBox</code><code class="p">();</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">userBox</code><code class="p">.</code><code class="nx">width</code><code class="p">,</code> <code class="s1">'80px'</code><code class="p">,</code>
    <code class="s1">'userBox should be 80px wide.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">menuBox</code><code class="p">.</code><code class="nx">width</code><code class="p">,</code> <code class="s1">'200px'</code><code class="p">,</code> 
    <code class="s1">'menuBox should be 200px wide.'</code>
  <code class="p">);</code>
<code class="p">});</code></pre>
<p id="right_favor_co">Right: Favor configuration</p>
<pre class="programlisting" data-language="js" id="var_createbox_"><code class="kd">var</code> <code class="nx">createBox</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">createBox</code><code class="p">(</code><code class="nx">options</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">defaults</code> <code class="o">=</code> <code class="p">{</code>
      <code class="nx">width</code><code class="o">:</code> <code class="s1">'80px'</code><code class="p">,</code>
      <code class="nx">height</code><code class="o">:</code> <code class="s1">'80px'</code>
    <code class="p">};</code>
  <code class="k">return</code> <code class="nx">$</code><code class="p">.</code><code class="nx">extend</code><code class="p">({},</code> <code class="nx">defaults</code><code class="p">,</code> <code class="nx">options</code><code class="p">);</code>
<code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Avoid Constants'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">userBox</code> <code class="o">=</code> <code class="nx">createBox</code><code class="p">({</code>
      <code class="nx">width</code><code class="o">:</code> <code class="s1">'80px'</code><code class="p">,</code>
      <code class="nx">height</code><code class="o">:</code> <code class="s1">'80px'</code>
    <code class="p">}),</code>
    <code class="nx">menuBox</code> <code class="o">=</code> <code class="nx">createBox</code><code class="p">({</code>
      <code class="nx">width</code><code class="o">:</code> <code class="s1">'200px'</code><code class="p">,</code>
      <code class="nx">height</code><code class="o">:</code> <code class="s1">'400px'</code>
    <code class="p">});</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">userBox</code><code class="p">.</code><code class="nx">width</code><code class="p">,</code> <code class="s1">'80px'</code><code class="p">,</code> 
    <code class="s1">'userBox should be 80px wide.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">menuBox</code><code class="p">.</code><code class="nx">width</code><code class="p">,</code> <code class="s1">'200px'</code><code class="p">,</code> 
    <code class="s1">'menuBox should be 200px wide.'</code>
  <code class="p">);</code>
<code class="p">});</code></pre>
</div>
<div class="sect3" id="use_functional_iterators_when_possible">
<div class="titlepage"><div><div><h4 class="title">Use Functional Iterators When Possible</h4></div></div></div>
<p id="javascript_offe">JavaScript offers the capability to program in a functional style, meaning that you can pass functions as arguments to other functions, and apply the passed in function to each element in a data resource (array or object). The technique is handy because it can make your code more readable, it can abstract away the looping mechanics, and keep the loop control variables isolated from your main function. That said, loops can give you finer grained control, and there can be performance considerations when you're looping over very large data sets.</p>
<p id="good">Good:</p>
<pre class="programlisting" data-language="js" id="var_getcount___id1"><code class="kd">var</code> <code class="nx">getCount</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">getCount</code><code class="p">()</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">i</code><code class="p">,</code>
      <code class="nx">count</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">],</code>
      <code class="nx">length</code> <code class="o">=</code> <code class="nx">count</code><code class="p">.</code><code class="nx">length</code><code class="p">,</code>
      <code class="nx">text</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>

    <code class="k">for</code> <code class="p">(</code><code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">text</code> <code class="o">+=</code> <code class="nx">count</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="o">+</code> <code class="s1">' '</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="nx">text</code><code class="p">;</code>
  <code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Looping over an array:'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">text</code> <code class="o">=</code> <code class="nx">getCount</code><code class="p">();</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">text</code><code class="p">,</code> <code class="s1">'1 2 3 '</code><code class="p">,</code> 
    <code class="s1">'getCount() should count to three.'</code>
  <code class="p">);</code>
<code class="p">});</code></pre>
<p id="better_for_most">Better for Most Situations:</p>
<pre class="programlisting" data-language="js" id="var_getcount___id2"><code class="kd">var</code> <code class="nx">getCount</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">getCount</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">count</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">],</code>
    <code class="nx">text</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>

  <code class="nx">count</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">number</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">text</code> <code class="o">+=</code> <code class="nx">number</code> <code class="o">+</code> <code class="s1">' '</code><code class="p">;</code>
  <code class="p">});</code>
  <code class="k">return</code> <code class="nx">text</code><code class="p">;</code>
<code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Functional iterator:'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">text</code> <code class="o">=</code> <code class="nx">getCount</code><code class="p">();</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">text</code><code class="p">,</code> <code class="s1">'1 2 3 '</code><code class="p">,</code> 
    <code class="s1">'getCount() should count to three.'</code>
  <code class="p">);</code>
<code class="p">});</code></pre>
<p id="note_that_you_d">Note that you don't need to worry about the <code class="code">i</code> or <code class="code">length</code> variables in this version.</p>
<p id="functional_iter">Functional iterators were added in ECMAScript 5, meaning that you'll need to shim them to prevent throwing errors in older browsers. Here's the MDN <code class="code">.forEach()</code> shim:</p>
<pre class="programlisting" data-language="js" id="shim_foreac"><code class="c1">// Shim .forEach()</code>
<code class="k">if</code> <code class="p">(</code> <code class="o">!</code><code class="nb">Array</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">forEach</code> <code class="p">)</code> <code class="p">{</code>
  <code class="nb">Array</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">forEach</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">fn</code><code class="p">,</code> <code class="nx">scope</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">for</code> <code class="p">(</code><code class="kd">var</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">len</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">len</code><code class="p">;</code> <code class="o">++</code><code class="nx">i</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">fn</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><code class="nx">scope</code> <code class="o">||</code> <code class="k">this</code><code class="p">,</code> <code class="k">this</code><code class="p">[</code><code class="nx">i</code><code class="p">],</code> <code class="nx">i</code><code class="p">,</code> <code class="k">this</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<div class="tip" id="a_shim_is_any_c_id1">
<p id="a_shim_is_any_c_id2">A <em class="firstterm">shim</em> is any code that wraps a standard API call in order to abstract it. Shims can be used to normalize cross browser behavior. A <em class="firstterm">polyfill</em> is a shim that implements new standard features from JavaScript, HTML5 and related technologies using existing capabilities in order to deliver that new functionality to older browsers. To learn more about using JavaScript polyfills, search for any new feature in the JavaScript method descriptions on the <em class="firstterm">Mozilla Developer Network</em> (MDN). Most of the new features include a complete or partial polyfill in the description.</p>
<p id="incidentally_t">Incidentally, the MDN documentation is perhaps the most thorough and authoritative online JavaScript reference. If you add the keyword "MDN" when you search google for JavaScript features, it should pull up the MDN documentation, instead of other much less reliable and much less complete references online.</p>
</div>
</div>
<div class="sect3" id="be_careful_with_if_statements">
<div class="titlepage"><div><div><h4 class="title">Be Careful With if Statements</h4></div></div></div>
<p id="the_results_of_">The results of type coercion in JavaScript can be difficult to predict, even when you know the rules. Here you'll see how subtle differences in comparisons can lead to significant changes in the results.</p>
<p id="be_careful_when">Be careful when relying on truthiness for logic. Whenever possible, use comparison operators to clarify your meaning. Falsy values include:</p>
<div class="itemizedlist" id="undefinednulle"><ul class="itemizedlist">
<li class="listitem"><p id="para_id3"><code class="code">0</code></p></li>
<li class="listitem"><p id="undefined"><code class="code">undefined</code></p></li>
<li class="listitem"><p id="null"><code class="code">null</code></p></li>
<li class="listitem"><p id="empty_strings">empty strings</p></li>
<li class="listitem"><p id="false"><code class="code">false</code></p></li>
</ul></div>
<div class="caution" id="boolean_objects_id1"><p id="boolean_objects_id2">Boolean objects instantiated with <code class="code">new Boolean(false)</code> are <span class="emphasis"><em>truthy</em></span> because they're objects, and objects are truthy. In order to test against them you need to use the <code class="code">.valueOf()</code> method. It's better in almost all cases  to use <code class="code">true</code> and <code class="code">false</code>, instead.</p></div>
<p id="empty_objects_a">Empty objects and empty arrays are truthy, including objects created with <code class="code">new Boolean(false)</code>.</p>
<p id="wrong_dont_us">Wrong: Don't use <code class="code">new Boolean()</code></p>
<p id="var_mybool__ne_id1"></p>
<pre class="programlisting" data-language="js" id="var_mybool__ne_id2"><code class="kd">var</code> <code class="nx">myBool</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Boolean</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Boolean object'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">myBool</code><code class="p">,</code> <code class="s1">'Should be falsy'</code><code class="p">);</code> <code class="c1">// Fails</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">myBool</code><code class="p">.</code><code class="nx">valueOf</code><code class="p">(),</code> 
    <code class="s1">'Should be falsy.'</code><code class="p">);</code> <code class="c1">// Passes</code>
<code class="p">});</code></pre>
<p id="right_use_true">Right: Use <code class="code">true</code> or <code class="code">false</code> in your boolean declarations</p>
<p id="var_mybool__fa_id1"></p>
<pre class="programlisting" data-language="js" id="var_mybool__fa_id2"><code class="kd">var</code> <code class="nx">myBool</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Boolean object'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="o">!</code><code class="nx">myBool</code><code class="p">,</code> <code class="s1">'!myBool should be false.'</code><code class="p">);</code>
<code class="p">});</code></pre>
<p id="the_following_s">The following series of tests are meant to demonstrate how different types of comparisons in JavaScript that look similar can deliver very different results. Always be careful that you're using the correct test for your situation:</p>
<pre class="programlisting" data-language="js" id="function_truthy"><code class="kd">function</code> <code class="nx">truthy</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
    <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Truthy'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="c1">// Falsy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="mi">0</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy(0)'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="s1">''</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"truthy('')"</code><code class="p">);</code>  <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="kc">null</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy(null)'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="kc">undefined</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> 
    <code class="s1">'truthy(undefined)'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="kc">false</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy(false)'</code><code class="p">);</code> <code class="c1">// Fail</code>

  <code class="c1">// Truthy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="s1">'0'</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"truthy('0')"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">(</code><code class="k">new</code> <code class="nb">Boolean</code><code class="p">(</code><code class="kc">false</code><code class="p">)),</code> <code class="kc">true</code><code class="p">,</code> 
    <code class="s1">'truthy(new Boolean(false))'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">({}),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy({})'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">([]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy([])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">([</code><code class="mi">0</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy([0])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">([</code><code class="mi">1</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'truthy([1])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">([</code><code class="s1">'0'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"truthy(['0'])"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">truthy</code><code class="p">([</code><code class="s1">'1'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"truthy(['1'])"</code><code class="p">);</code> <code class="c1">// Pass</code>
<code class="p">});</code></pre>
<p id="these_are_the_f">These are the falsy and truthy values we'll use as a baseline for a series of other comparisons.</p>
<div class="caution" id="often_develope_id1"><p id="often_develope_id2">Often, developers will use <code class="code">if (x)</code> when they really want to see if the value has been set at all. This is especially problematic when <code class="code">0</code>, empty strings, or <code class="code">false</code> are valid values. In that case, you want the test to pass as long as the expression evaluates to anything other than <code class="code">null</code> or <code class="code">undefined</code>.  A good rule of thumb is to only use <code class="code">if (x)</code> to evaluate booleans or the existence of objects or arrays.</p></div>
<pre class="programlisting" data-language="js" id="function_exists_id1"><code class="kd">function</code> <code class="nx">exists</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">x</code> <code class="o">!==</code> <code class="kc">undefined</code> <code class="o">&amp;&amp;</code> <code class="nx">x</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
    <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'exists'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="c1">// Falsy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="mi">0</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists(0)'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="s1">''</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"exists('')"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="kc">null</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists(null)'</code><code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="kc">undefined</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists(undefined)'</code><code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="kc">false</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists(false)'</code><code class="p">);</code> <code class="c1">// Pass</code>

  <code class="c1">// Truthy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="s1">'0'</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"exists('0')"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">(</code><code class="k">new</code> <code class="nb">Boolean</code><code class="p">(</code><code class="kc">false</code><code class="p">)),</code> <code class="kc">true</code><code class="p">,</code> 
    <code class="s1">'exists(new Boolean(false))'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">({}),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists({})'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">([]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists([])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">([</code><code class="mi">0</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists([0])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">([</code><code class="mi">1</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'exists([1])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">([</code><code class="s1">'0'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"exists(['0'])"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">exists</code><code class="p">([</code><code class="s1">'1'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"exists(['1'])"</code><code class="p">);</code> <code class="c1">// Pass</code>
<code class="p">});</code></pre>
<p id="of_course_a_sh">Of course, a shorter version of that function will return the same results:</p>
<pre class="programlisting" data-language="js" id="function_exists_id2"><code class="kd">function</code> <code class="nx">exists</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="nx">x</code> <code class="o">!==</code> <code class="kc">undefined</code> <code class="o">&amp;&amp;</code> <code class="nx">x</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">);</code>
<code class="p">}</code></pre>
<div class="caution" id="the__operator_id1"><p id="the__operator_id2">The <code class="code">==</code> operator can return some problematic results due to type coercion. For example, say you're checking an array to be sure it contains a valid price, and some items cost $0.00. Your code could fail because <code class="code">['0.00'] == false</code>. Use <code class="code">===</code> instead.</p></div>
<pre class="programlisting" data-language="js" id="var_isfalse__f_id1"><code class="kd">var</code> <code class="nx">isFalse</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">isFalse</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="nx">x</code> <code class="o">==</code> <code class="kc">false</code><code class="p">);</code>
<code class="p">};</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'isFalse using =='</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="c1">// Falsy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="mi">0</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse(0)'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="s1">''</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"isFalse('')"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="kc">null</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse(null)'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="kc">undefined</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse(undefined)'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="kc">false</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse(false)'</code><code class="p">);</code> <code class="c1">// Pass</code>


  <code class="c1">// Truthy</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="s1">'0'</code><code class="p">),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"isFalse('0')"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">(</code><code class="k">new</code> <code class="nb">Boolean</code><code class="p">(</code><code class="kc">false</code><code class="p">)),</code> <code class="kc">true</code><code class="p">,</code> 
    <code class="s1">'isFalse(new Boolean(false))'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">({}),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse({})'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">([]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse([])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">([</code><code class="mi">0</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse([0])'</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">([</code><code class="mi">1</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s1">'isFalse([1])'</code><code class="p">);</code> <code class="c1">// Fail</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">([</code><code class="s1">'0'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"isFalse(['0'])"</code><code class="p">);</code> <code class="c1">// Pass</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">isFalse</code><code class="p">([</code><code class="s1">'1'</code><code class="p">]),</code> <code class="kc">true</code><code class="p">,</code> <code class="s2">"isFalse(['1'])"</code><code class="p">);</code> <code class="c1">// Fail</code>
<code class="p">});</code></pre>
<p id="the_following_c">The following code will only return true if <code class="code">x</code> is actually set to <code class="code">false</code>:</p>
<pre class="programlisting" data-language="js" id="var_isfalse__f_id2"><code class="kd">var</code> <code class="nx">isFalse</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">isFalse</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="nx">x</code> <code class="o">===</code> <code class="kc">false</code><code class="p">);</code>
<code class="p">};</code></pre>
<p id="the_following_f">The following function is dangerous, because  it will return <code class="code">true</code> for <code class="code">1</code>, <code class="code">[1]</code>, and <code class="code">['1']</code>.</p>
<pre class="programlisting" data-language="js" id="var_istrue__fu"><code class="kd">var</code> <code class="nx">isTrue</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">isTrue</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="nx">x</code> <code class="o">==</code> <code class="kc">true</code><code class="p">);</code>
<code class="p">};</code></pre>
<p id="use__instead">Use <code class="code">===</code> instead to eliminate the possibility of false positives.</p>
<p id="remember_that_i">Remember that <code class="code">if (x)</code> will always return true when <code class="code">x</code> is an object -- even if the object is empty. It's common to use <em class="firstterm">ducktyping</em> when you examine objects. (If it walks like a duck and talks like a duck, treat it like a duck.) The idea is similar to using feature detection in browsers, instead of running checks against the browser string. Ducktyping is feature detection for objects.</p>
<pre class="programlisting" data-language="js" id="if_typeof_foo"><code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">foo</code><code class="p">.</code><code class="nx">bar</code> <code class="o">===</code> <code class="s1">'function'</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">foo</code><code class="p">.</code><code class="nx">bar</code><code class="p">();</code>
<code class="p">}</code></pre>
</div>
<div class="sect3" id="avoid_side_effects">
<div class="titlepage"><div><div><h4 class="title">Avoid Side Effects</h4></div></div></div>
<p id="in_order_to_avo">In order to avoid unintended side effects,  only assign to variables declared inside your function, or declared as formal parameters.</p>
<p id="wrong_has_side">Wrong: Has Side Effects</p>
<pre class="programlisting" data-language="js" id="var_x___func_id1"><code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

<code class="kd">function</code> <code class="nx">increment</code><code class="p">()</code> <code class="p">{</code>
  <code class="nx">x</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">x</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'increment() with side effects.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">val</code> <code class="o">=</code> <code class="nx">increment</code><code class="p">();</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">val</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s1">'increment() should add one.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">x</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s1">'x should be unchanged outside the function.'</code>
  <code class="p">);</code> <code class="c1">// Fails</code>
<code class="p">});</code></pre>
<p id="right_no_side_">Right: No Side Effects</p>
<pre class="programlisting" data-language="js" id="var_x___func_id2"><code class="kd">var</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

<code class="kd">function</code> <code class="nx">increment</code><code class="p">(</code><code class="nx">x</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">x</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">x</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'increment() without side effects.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">val</code> <code class="o">=</code> <code class="nx">increment</code><code class="p">(</code><code class="nx">x</code><code class="p">);</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">val</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s1">'increment() adds one.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">x</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s1">'x is unchanged.'</code>
  <code class="p">);</code>
<code class="p">});</code></pre>
<p id="wherever_possib_id1">Wherever possible, you should avoid mutating objects declared outside your function. This isn't always practical, but where it is, your code will be more reusable and less <em class="firstterm">brittle</em> (likely to break when unrelated code changes).</p>
<p id="use_with_cautio">Use With Caution: Object Mutation Side Effects</p>
<pre class="programlisting" data-language="js" id="var_obj___val_id1"><code class="kd">var</code> <code class="nx">obj</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">value</code><code class="o">:</code> <code class="mi">2</code>
  <code class="p">};</code>

<code class="kd">function</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">obj</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">obj</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">obj</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'setValue() with side effects'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">myObj</code> <code class="o">=</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">obj</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">myObj</code><code class="p">.</code><code class="nx">value</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> 
    <code class="s1">'setValue() returns new value.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">obj</code><code class="p">.</code><code class="nx">value</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code>
    <code class="s1">'The original should be unchanged.'</code>
  <code class="p">);</code> <code class="c1">// Fails</code>
<code class="p">});</code></pre>
<p id="better_return_">Better: Return a new object</p>
<pre class="programlisting" data-language="js" id="var_obj___val_id2"><code class="kd">var</code> <code class="nx">obj</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">value</code><code class="o">:</code> <code class="mi">2</code>
  <code class="p">};</code>

<code class="kd">function</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">obj</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">instance</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">obj</code><code class="p">);</code>
  
  <code class="nx">instance</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>
  <code class="k">return</code> <code class="nx">instance</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'setValue() without side effects'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">myObj</code> <code class="o">=</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">obj</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>

  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">myObj</code><code class="p">.</code><code class="nx">value</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code>
    <code class="s1">'setValue() should return new value.'</code>
  <code class="p">);</code>
  <code class="nx">equal</code><code class="p">(</code>
    <code class="nx">obj</code><code class="p">.</code><code class="nx">value</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code>
    <code class="s1">'The original is should be unchanged!'</code>
  <code class="p">);</code> <code class="c1">// Passes</code>
<code class="p">});</code></pre>
</div>
<div class="sect3" id="dont_use_switch">
<div class="titlepage"><div><div><h4 class="title">Don't Use Switch</h4></div></div></div>
<p id="javascript_has__id2">JavaScript has pretty normal control flow statements that use blocks delineated by curly braces. There is an exception to this: The <code class="code">switch ... case</code> statement. The strange thing about  <code class="code">switch ... case</code>  is that you must include the keyword <code class="code">break</code> at the end of each <code class="code">case</code> to prevent control from falling through to the next <code class="code">case</code>. <em class="firstterm">Fall through</em> is a trick that allows you to let more than one case be executed. Control will fall through automatically to the next case unless you explicitly tell it not to with <code class="code">break</code>. However, like the optional semi colons and curly braces, it's possible to forget <code class="code">break</code> when you really should have used it. When that happens, the bug is difficult to find because the code <span class="emphasis"><em>looks correct</em></span>. For that reason, the <code class="code">break</code> statement should never be left off of a <code class="code">case</code>, even by design.</p>
<p id="with_that_said">With that said, JavaScript has an elegant object literal syntax and first class functions, which makes it simple to create a keyed <em class="firstterm">method lookup</em>. The object you create for your method lookup is called an <em class="firstterm">action object</em> or   <em class="firstterm">command object</em>, and is used in many software <em class="firstterm">design patterns</em>, including the useful and versatile <em class="firstterm">command pattern</em>. See the section on the command pattern for more details. </p>
<p id="say_youre_crea">Say you're creating a game where the non-player fight actions are selected based on an algorithm defined elsewhere and passed in to doAction as a string. The <code class="code">switch ... case</code> form looks like this:</p>
<pre class="programlisting" data-language="js" id="function_doacti_id1"><code class="kd">function</code> <code class="nx">doAction</code><code class="p">(</code><code class="nx">action</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">switch</code> <code class="p">(</code><code class="nx">action</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">case</code> <code class="s1">'hack'</code><code class="o">:</code>
      <code class="k">return</code> <code class="s1">'hack'</code><code class="p">;</code>
    <code class="k">break</code><code class="p">;</code>

    <code class="k">case</code> <code class="s1">'slash'</code><code class="o">:</code>
      <code class="k">return</code> <code class="s1">'slash'</code><code class="p">;</code>
    <code class="k">break</code><code class="p">;</code>

    <code class="k">case</code> <code class="s1">'run'</code><code class="o">:</code>
      <code class="k">return</code> <code class="s1">'run'</code><code class="p">;</code>
    <code class="k">break</code><code class="p">;</code>

    <code class="k">default</code><code class="o">:</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Invalid action.'</code><code class="p">);</code>
    <code class="k">break</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p id="the_method_look_id1">The   method lookup version looks like this:</p>
<pre class="programlisting" data-language="js" id="function_doacti_id2"><code class="kd">function</code> <code class="nx">doAction</code><code class="p">(</code><code class="nx">action</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">actions</code> <code class="o">=</code> <code class="p">{</code>
    <code class="s1">'hack'</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="s1">'hack'</code><code class="p">;</code>
    <code class="p">},</code>

    <code class="s1">'slash'</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="s1">'slash'</code><code class="p">;</code>
    <code class="p">},</code>

    <code class="s1">'run'</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="s1">'run'</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>
 
  <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">actions</code><code class="p">[</code><code class="nx">action</code><code class="p">]</code> <code class="o">!==</code> <code class="s1">'function'</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Invalid action.'</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="k">return</code> <code class="nx">actions</code><code class="p">[</code><code class="nx">action</code><code class="p">]();</code>
<code class="p">}</code></pre>
<p id="or_for_input_g">Or, for input grouping (a frequent use case for the fall through feature): Say you're writing a programming language parser, and you want to perform one action whenever you encounter a <em class="firstterm">token</em> that opens an object or array, and another whenever you encounter a token that closes them. Assume the following functions exist:</p>
<pre class="programlisting" data-language="js" id="function_handle"><code class="kd">function</code> <code class="nx">handleOpen</code><code class="p">(</code><code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="s1">'Open object / array.'</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">handleClose</code><code class="p">(</code><code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="s1">'Close object / array'</code><code class="p">;</code>
<code class="p">}</code></pre>
<p id="the_switch__">The <code class="code">switch ... case</code> form is:</p>
<pre class="programlisting" data-language="js" id="function_proces"><code class="kd">function</code> <code class="nx">processToken</code> <code class="p">(</code><code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">switch</code> <code class="p">(</code><code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">case</code> <code class="s1">'{'</code><code class="o">:</code>
    <code class="k">case</code> <code class="s1">'['</code><code class="o">:</code>
      <code class="nx">handleOpen</code><code class="p">(</code><code class="nx">token</code><code class="p">);</code>
    <code class="k">break</code><code class="p">;</code>

    <code class="k">case</code> <code class="s1">']'</code><code class="o">:</code>
    <code class="k">case</code> <code class="s1">'}'</code><code class="o">:</code>
      <code class="nx">handleClose</code><code class="p">(</code><code class="nx">token</code><code class="p">);</code>
    <code class="k">break</code><code class="p">;</code>

    <code class="k">default</code><code class="o">:</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Invalid token.'</code><code class="p">);</code>
    <code class="k">break</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p id="the_method_look_id2">The method lookup version looks like this:</p>
<pre class="programlisting" data-language="js" id="var_tokenaction"><code class="kd">var</code> <code class="nx">tokenActions</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s1">'{'</code><code class="o">:</code> <code class="nx">handleOpen</code><code class="p">,</code>
  <code class="s1">'['</code><code class="o">:</code> <code class="nx">handleOpen</code><code class="p">,</code>
  <code class="s1">']'</code><code class="o">:</code> <code class="nx">handleClose</code><code class="p">,</code>
  <code class="s1">'}'</code><code class="o">:</code> <code class="nx">handleClose</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">processToken</code><code class="p">(</code><code class="nx">token</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">tokenActions</code><code class="p">[</code><code class="nx">token</code><code class="p">]</code> <code class="o">!==</code> <code class="s1">'function'</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Invalid token.'</code><code class="p">);</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">tokenActions</code><code class="p">[</code><code class="nx">token</code><code class="p">](</code><code class="nx">token</code><code class="p">);</code>
<code class="p">}</code></pre>
<p id="at_first_glance">At first glance, it might seem like this is more complicated syntax, but it has a few advantages:</p>
<div class="itemizedlist" id="it_uses_the_sta_id1"><ul class="itemizedlist">
<li class="listitem"><p id="it_uses_the_sta_id2">It uses the standard curly-bracket blocks used everywhere else in JavaScript.</p></li>
<li class="listitem"><p id="you_never_have_">You never have to worry about remembering the <code class="code">break</code>.</p></li>
<li class="listitem"><p id="method_lookup_i_id1">Method lookup is much more flexible. Using an action object allows you to alter the cases dynamically at runtime. For example, to allow dynamically loaded modules to extend cases, or even swap out some or all of the cases for modal context switching.</p></li>
<li class="listitem"><p id="method_lookup_i_id2">Method lookup is object-oriented by definition. With <code class="code">switch ... case</code>, your code is more procedural.</p></li>
</ul></div>
<p id="the_last_point_">The last point is perhaps the most important. The <code class="code">switch</code> statement is a close relative of the <code class="code">goto</code> statement, which computer science  giants argued for twenty years to eradicate from modern programming languages. It has the same serious drawback: Almost everywhere I've seen <code class="code">switch ... case</code> used, I've seen it abused. Developers group unrelated functionality into overly-clever branching logic. In other words, <code class="code">switch ... case</code> tends to encourage <em class="firstterm">spaghetti code</em>, while method lookup tends to encourage well-organized, object-oriented code. It's far too common to find implementations of <code class="code">switch ... case</code> which break the principles of <em class="firstterm">high cohesion</em> and <em class="firstterm">separation of concerns</em>.</p>
<p id="i_was_once_a_fa">I was once a fan of <code class="code">switch ... case</code> as a better alternative to <code class="code">if ... else</code>, but after becoming more familiar with JavaScript, I naturally fell into using method lookup, instead. I haven't used <code class="code">switch ... case</code> in my code for several years. I don't miss it at all.</p>
<div class="tip" id="if_you_ever_fin_id1">
<p id="if_you_ever_fin_id2">If you ever find yourself writing a <code class="code">switch</code> statement, stop and ask yourself the following questions:</p>
<div class="itemizedlist" id="will_you_ever_n_id1"><ul class="itemizedlist">
<li class="listitem"><p id="will_you_ever_n_id2">Will you ever need to add more cases? (Queue, Stack, Plugin Architecture)</p></li>
<li class="listitem"><p id="would_it_be_use_id1">Would it be useful to modify the list of cases at run-time? For example, to change the list of enabled  options based on context? (Mode switching)</p></li>
<li class="listitem"><p id="would_it_be_use_id2">Would it be useful to log the cases that get executed? For example, to create an undo / redo stack, or log user actions to your servers for analysis? (<em class="firstterm">Command Manager</em>)</p></li>
<li class="listitem"><p id="are_you_referen">Are you referencing your cases by incrementing numbers? E.g. <code class="code">case 1:</code>, <code class="code">case: 2</code>, etc... (<em class="firstterm">Iterator</em> target)</p></li>
<li class="listitem"><p id="are_you_trying_">Are you trying to group related inputs together with the fall through feature so that they can share code?</p></li>
</ul></div>
<p id="if_you_answered">If you answered yes to any of these questions, there is almost certainly a better implementation that doesn't utilize <code class="code">switch</code>, or its slippery fall through feature.</p>
</div>
</div>
<div class="sect3" id="dont_use_eval">
<div class="titlepage"><div><div><h4 class="title">Don't Use Eval</h4></div></div></div>
<p id="the_desire_to_u_id1">The desire to use <code class="code">eval()</code> should be considered a <em class="firstterm">code smell</em> (as in, "something smells fishy"). It's a good indication that there is probably a better way to accomplish what you're after.</p>
<div class="tip" id="youll_often_he_id1"><p id="youll_often_he_id2">You'll often hear programmers say things like, "this smells", or "something smells funny here." They're not talking about  the garlic burger you had for lunch. They're expressing that something doesn't feel right about the code. Maybe a function is too long, or it's doing too much. Maybe there's a better, smarter, faster, or easier way to accomplish the same goal. Things like large inheritance trees and deeply nested logic send up red flags for experienced programmers. Those are code smells.</p></div>
<p id="javascript_is_a">JavaScript is a very flexible, expressive, dynamic language with a lot less need for <code class="code">
            <code class="code">eval()</code>
          </code> than most other languages.</p>
<p id="most_of_what_ev">Most of what <code class="code">eval()</code> can do for you can be done with code that is faster and easier to read. Using eval forces the JavaScript engine to delay compilation of the <code class="code">eval()</code> code, bypassing the usual code compilation flow.</p>
<p id="eval_can_also_p">Eval can also poke holes in your security and allow  Cross Site Scripting (XSS) attacks.</p>
<p id="some_good_alter">Some good alternatives to <code class="code">eval()</code> and its dopplegangers include <em class="firstterm">square bracket notation</em> (covered in the section on invoking functions), runtime object mutation, and <em class="firstterm">function currying</em> (see the section on function currying in the functions chapter). The <code class="code">eval()</code> function should only be used with great caution, and only if it is absolutely the only way to accomplish your goal.</p>
<div class="caution" id="the_eval_func_id1"><div class="itemizedlist" id="the_eval_func_id2">
<p id="the_eval_func_id3">The <code class="code">eval()</code> function has dopplegangers you should also avoid:</p>
<ul class="itemizedlist">
<li class="listitem"><p id="passing_a_strin_id1">Passing a string to the <code class="code">Function()</code> constructor.</p></li>
<li class="listitem"><p id="passing_a_strin_id2">Passing a string value to <code class="code">setTimeout()</code> or <code class="code">setInterval()</code> (as opposed to a function reference or lambda expression).</p></li>
</ul>
</div></div>
</div>
</div>
</div></section><footer><div class="navfooter">
<hr>
<table style="width: 100%; ">
<tr>
<td style="width: 40%; text-align: left; ">
<a accesskey="p" href="ch01.html">Prev</a> </td>
<td style="width: 20%; text-align: center; "> </td>
<td style="width: 40%; text-align: right; "> <a accesskey="n" href="ch03.html">Next</a>
</td>
</tr>
<tr>
<td style="width: 40%; text-align: left; vertical-align: top; ">Chapter 1. The JavaScript Revolution </td>
<td style="width: 20%; text-align: center; "><a accesskey="h" href="index.html">Home</a></td>
<td style="width: 40%; text-align: right; vertical-align: top; "> Chapter 3. Functions</td>
</tr>
</table>
</div></footer>


	<div class="extra-footer">
		<p>© 2013, O’Reilly Media, Inc.</p>
		<ul>
			<li><a href="http://oreilly.com/terms/">Terms of Service</a></li>
			<li><a href="http://oreilly.com/oreilly/privacy.csp">Privacy Policy</a></li>
			<li>Interested in <a href="mailto:scordesse@oreilly.com">sponsoring content?</a></li>
		</ul>
	</div>
<script type="text/javascript">if (!NREUMQ.f) { NREUMQ.f=function() {
NREUMQ.push(["load",new Date().getTime()]);
var e=document.createElement("script");
e.type="text/javascript";
e.src=(("http:"===document.location.protocol)?"http:":"https:") + "//" +
  "rpm-images.newrelic.com/42/eum/rum.js";
document.body.appendChild(e);
if(NREUMQ.a)NREUMQ.a();
};
NREUMQ.a=window.onload;window.onload=NREUMQ.f;
};
NREUMQ.push(["nrfj","beacon-3.newrelic.com","3e361aebcf","2194180","IApbRUBZXg1WEEoHDAwORh5aQl8N",17,60,new Date().getTime(),"","","","",""]);</script></body>
</html>