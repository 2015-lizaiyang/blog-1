<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head><script type="text/javascript">var NREUMQ=NREUMQ||[];NREUMQ.push(["mark","firstbyte",new Date().getTime()]);</script>
	<title>Programming JavaScript Applications</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/book-748da559db3e7bc457e1e4da3b2fa1e9.css" media="screen" rel="stylesheet" type="text/css" />
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/default-6b113e470a1a8ec83000e32a1548bc3a.css" media="screen" rel="stylesheet" type="text/css" />
	<script src="http://dwn0odqttrkhc.cloudfront.net/assets/application-984298d79dbc8412cdf579684d9338f6.js" type="text/javascript"></script>
	<script src="http://dwn0odqttrkhc.cloudfront.net/assets/book-756862b9ed04d945ca53de5b8f106a83.js" type="text/javascript"></script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<link href="http://dwn0odqttrkhc.cloudfront.net/assets/janrain-53eb5abed55992e21943b9d3373923e8.css" media="all" rel="stylesheet" type="text/css" />
	<meta content="authenticity_token" name="csrf-param" />
<meta content="/GRp+voJrKFbA/jwI0ONBTu50Yc1318lY+g/Lg0VKOo=" name="csrf-token" />
	<script type="text/javascript" charset="utf-8">
  	
		app.data = new classes.Data({"controller":{"controller":"books","action":"html"},"capturable":{"capture_server":"https://oreilly.janraincapture.com","client_id":"6n5q2k9vesqgn93k3mhevka6c3c3rsre","app_url":"https://login.oreilly.com","app_id":"xsnca5wmqe9vxv97ygh5vfejkd","load_js":"d16s8pqtk4uodx.cloudfront.net/login.oreilly.com/load.js"},"user":{"id":null,"account":"LoggedOutAccount","email":"","name":null,"gravatar_url":"http://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=40&d=identicon"},"book":{"isbn":"1234000000262","chapter":"ch05.html","toc_url":"/books/1234000000262/toc_html","metadata_url":"http://d4bb7yl96lyl1.cloudfront.net/1234000000262/metadata/metadata_c6a0e8997c9604111d0171fb2d72f5c1b6cfd618.json"},"abilities":{"can_destroy_all_comments":false,"can_create_comments":false},"advertisement":{"body":"<style>      \r\n.ad-profile-image {\r\n  padding: 0;\r\n  margin: 0;\r\n  max-height: 30px;\r\n }\r\n\r\n.top-banner {\r\n  position: absolute;\r\n  right: 0;\r\n  top: 34px;\r\n  z-index: 99999;\r\n}\r\n\r\np.banner-text {\r\n  margin: 0;\r\n  text-align: center;\r\n  padding-right: 10px;\r\n  width: 500px;\r\n}\r\n\r\n@media screen and (max-width: 600px) {\r\n   p.banner-text {\r\n     width: 100%;\r\n     text-align: center;\r\n  }\r\n}\r\n\r\nspan.ebook-advantage {\r\n  font-size: smaller;\r\n  display: block;\r\n}\r\n\r\ndiv.banner-container {\r\n  margin: 0 auto;\r\n}\r\n\r\ndiv.banner-container ul {\r\n  margin: 0 auto;\r\n}\r\n\r\ndiv.topad { padding-bottom: 5px; }\r\n\r\ndiv.banner-container ul li {\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n}\r\n\r\ndiv.banner-container li p {\r\n  padding-top: 0;\r\n  margin-top: 0;\r\n}\r\n\r\ndiv.banner-container li.sponsor {\r\n  border-right: 1px solid rgb(125, 154, 180);\r\n  margin-right: 5px;\r\n  padding-right: 10px;\r\n}\r\n\r\ndiv.banner-container .webbutton {\r\n  background-color: #3994b6;\r\n  display: inline-block;\r\n  padding: 10px;\r\n  -webkit-border-radius: 5px;\r\n  -moz-border-radius: 5px;\r\n  border-radius: 5px;\r\n  color: #FFF;\r\n  text-align: center;\r\n  text-decoration: none;\r\n  font-size: 12px;\r\n  font-weight: bold;\r\n}\r\n\r\n</style>\r\n   \r\n<div style=\"color: rgb(125, 154, 180);\">\r\n\r\n<div class=\"banner-container\">\r\n\r\n<ul>\r\n\r\n<li class=\"sponsor\">\r\n<!--CONFERENCE SPONSOR IMAGE-->\r\n<a href=\"http://velocityconf.com/\">\r\n<img src=\"http://orm-other.s3.amazonaws.com/velocity_logo.png\" class=\"ad-profile-image\"/>\r\n<!-- <img src=\"http://orm-other.s3.amazonaws.com/fluent_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/oscon_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/strata_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/StrataRx_logo.png\" class=\"ad-profile-image\"/>\r\n<img src=\"http://orm-other.s3.amazonaws.com/velocity_logo.png\" class=\"ad-profile-image\"/> -->\r\n</a>\r\n</li>\r\n\r\n<li>\r\n<!--AD TEXT, 2 LINES, REPLACE LINK URL AS WELL-->\r\n<p class=\"banner-text\">Enjoy this free Early Release version of <em>Programming JavaScript Applications</em>. Purchase and download the DRM-free ebook on <a href=\"http://shop.oreilly.com/product/0636920024231.do?intcmp=il-npa-books-video-product_chimera\">oreilly.com</a>.<span class=\"ebook-advantage\">Learn more about the O’Reilly <a href=\"http://shop.oreilly.com/category/ebooks.do\">Ebook Advantage</a>.</span></p>\r\n</li>\r\n\r\n<li>\r\n<!--BUY BUTTON-->\r\n<a class=\"webbutton\" href=\"http://shop.oreilly.com/product/0636920024231.do?intcmp=il-npa-books-video-product_chimera\">Buy the Ebook</a>\r\n</li> \r\n\r\n</ul>\r\n\r\n</div>\r\n\r\n<!--CORNER BANNER (IF NEEDED)-->\r\n<!--<a href=\"http://shop.oreilly.com/product/0636920025245.do\" class=\"top-banner\"><img src=\"http://orm-other.s3.amazonaws.com/banner.png\" /></a>-->\r\n\r\n</div>"}});

		/* Janrain setup */
  	var janrainModal = new JanrainView();
  	$("head").append(janrainModal.render().el);

  	/* segment.io setup */
  	var analytics=analytics||[];analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var r=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["identify","track","trackLink","trackForm","trackClick","trackSubmit","pageview","ab","alias","ready"];for(var s=0;s<i.length;s++)analytics[i[s]]=r(i[s])};
  	
  	analytics.load("hg9h6b9pae");

  	$(function() {
			app.bookapp = new BookApp();
		});
	
	</script>
</head>
<body>
	<div id="menu">
	
		<ul id="menu-left">
			<li id="home-link"><a href="/"><i class="icon-house"></i></a></li>
			<li><a href="/books/1234000000262">Programming JavaScript Applications</a></li>
			<div class="clear"></div>
		</ul>
	
		<ul id="menu-right">
			<li id="comments-link"><a>&nbsp;</a></li>
			<li>
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapters</a>
				<div id="toc-popup" class="dropdown-menu"></div>
			</li>
				<li><a href="#" class="capture_modal_open" id="capture_signin_link">Log In / Sign Up</a></li>
			<li id="search-li">
				<form accept-charset="UTF-8" action="/searches" id="search-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
	<input name='search[q]' type="text" placeholder="Search book..." id="book-search" />

	<input id="search_bookId" name="search[bookId]" type="hidden" value="1234000000262" />
	
	<div style='display:none'>
		sorted by: 
		<select name='search[sort]' >
			<option value='relevance'>Relevance</option>
			<option value='authors'>Author(s)</option>
			<option value='title'>Title</option>
		</select>
		returning
		<select name='search[limit]' >
			<option value='5'>5</option>
			<option value='10'>10</option>
			<option value='20'>20</option>
			<option selected="selected" value='50'>50</option>
			<option value='100'>100</option>
		</select>
		values at a time.
	</div>
</form>
			</li>
			<div class="clear"></div>
		</ul>
		<div class="clear"></div>
	
</div>
	<header><div class="navheader">
<table style="width: 100%; ">
<tr><td style="text-align: center; " colspan="3">Chapter 5. Modules</td></tr>
<tr>
<td style="width: 20%; text-align: left; ">
<a accesskey="p" href="ch04.html">Prev</a> </td>
<td style="width: 60%; text-align: center; "> </td>
<td style="width: 20%; text-align: right; "> <a accesskey="n" href="ch06.html">Next</a>
</td>
</tr>
</table>
<hr>
</div></header><section class="chapter" data-original-filename="ch05.xml" id="chapm73s80000ytoc3q5rzdxt"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Modules</h1></div></div></div>
<p id="modules_are_reu">Modules are reusable software components which form the building blocks of applications. Modularity satisfies some very important design goals,  perhaps the most important of which is simplicity.</p>
<p id="when_you_design_id3">When you design an application with a lot of interdependencies between different parts of the application, it becomes more difficult to fully understand the impact of your changes across the whole system.</p>
<p id="when_you_design_id4">When you design part of a system to a modular interface contract, you can safely make changes without having a deep understanding of all of the related modules.</p>
<p id="another_importa">Another important goal of modularity is the ability to reuse your module in other applications. Well designed modules built on similar frameworks should be easy to transplant into new applications with few (if any) changes. By defining a standard interface for application extensions, and then building your functionality on top of that interface, you'll go a long way toward building an application that is easy to extend and maintain, and easy to reassemble into different forms in the future.</p>
<p id="javascript_modu">JavaScript modules are encapsulated, meaning that they keep implementation details private, and expose a public API. That way, you can change how a module behaves under the hood without changing code that relies on it. Encapsulation also provides <em class="firstterm">protection</em>, meaning that it prevents outside code from interfering with the functionality of the module. </p>
<p id="there_are_sever_id3">There are several ways to define modules in JavaScript. The most popular and common are the module pattern, CommonJS modules (used in Node), and AMD (Asynchronous Module Definition).</p>
<div class="sect1" data-original-filename="ch05.xml" id="principles_of_modularity">
<div class="titlepage"><div><div><h2 class="title">Principles of Modularity</h2></div></div></div>
<p id="you_can_think_o">You can think of modules as small, independent applications that are fully functional and fully testable in their own right. Keep them as small and simple as possible to do the job that they are designed to do.</p>
<p id="modules_should_">Modules should be:</p>
<div class="itemizedlist" id="specialized_ea_id1"><ul class="itemizedlist">
<li class="listitem"><p id="specialized_ea_id2">Specialized: Each module should have a very specific function. The module's parts should be integral to solving the single problem that the module exists to solve. The public API should be simple and clean.</p></li>
<li class="listitem"><p id="independent_mo">Independent: Modules should know as little as possible about other modules. Instead of calling other modules directly, they should communicate between mediators, such as a central event handling system or command object.</p></li>
<li class="listitem"><p id="decomposable_i">Decomposable: It should be fairly simple to test and use modules in isolation from other modules. It's common to compare them to components in an entertainment system. You could have a disc player, radio receiver, TV, amplifier and speakers, all of which can operate independently of each other. If you remove the disc player, the rest of the components continue to function properly.</p></li>
<li class="listitem"><p id="recomposable_i">Recomposable: It should be possible to fit various modules together in different ways, in order to build a different version of the same software, or an entirely different application.</p></li>
<li class="listitem"><p id="substitutable_">Substitutable: It should be possible to completely substitute one module with another, as long is it supplies the same interface. The rest of the application should not be adversely impacted by the change. The substitute module doesn't have to perform the same function. For example, you might want to substitute a data module that uses REST endpoints as its data source with one that uses a local storage database as its data source.</p></li>
</ul></div>
<div class="tip" id="the_open_closed_id1"><p id="the_open_closed_id2"><em class="firstterm">The Open Closed Principle</em> states that a module interface should be open to extension but closed to modification. Changing an interface that a lot of software relies on can be a daunting task. It's best if you can avoid making changes to an existing interface once it has been established. However, software should evolve, and as it does, it should be easy to extend existing interfaces with new functionality.</p></div>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="interfaces">
<div class="titlepage"><div><div><h2 class="title">Interfaces</h2></div></div></div>
<p id="the_gang_of_fou"></p>
<div class="blockquote"><table style="border: 0; " class="blockquote">
<tr>
<td style="width: 10%; vertical-align: top; "> </td>
<td style="width: 80%; vertical-align: top; "><p id="program_to_an_">"Program to an interface, not an implementation."</p></td>
<td style="width: 10%; vertical-align: top; "> </td>
</tr>
<tr>
<td style="width: 10%; vertical-align: top; "> </td>
<td style="text-align: right; vertical-align: top; " colspan="2">--<span class="attribution">The Gang of Four, "Design Patterns"</span>
</td>
</tr>
</table></div>
<p id="interfaces_are_"><em class="firstterm">Interfaces</em> are one of the primary tools of modular software design. Interfaces define a contract that an implementing module will fulfill. For instance, a common problem in JavaScript applications is that the application stops functioning if the Internet connection is lost. In order to solve that problem, you could use local storage and sync changes periodically with the server. Unfortunately, some browsers don't support local storage, so you may have to fall back to cookies or even flash (depending on how much data you need to store).</p>
<p id="that_will_be_di">That will be difficult if your business logic depends directly on your the localStorage features. For example, in <a class="xref" href="ch05.html#fig0501" title="Figure 5-1. Direct Dependency">Figure 5-1</a>:</p>
<div class="figure" id="fig0501">
<div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 225; cellpadding: 0; cellspacing: 0;"><tr><td><img style="width: 225; " src="http://orm-chimera-prod.s3.amazonaws.com/1234000000262/figs/0501.png" alt="Direct Dependency"></td></tr></table></div></div>
<div class="figure-title">Figure 5-1. Direct Dependency</div>
</div>
<p id="a_better_altern">A better alternative is to create a standard interface to provide data access for the post module. That way, the module can retrieve data using the same interface, regardless of where the data is being stored. See <a class="xref" href="ch05.html#fig0502" title="Figure 5-2. Interface">Figure 5-2</a>:</p>
<div class="figure" id="fig0502">
<div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 225; cellpadding: 0; cellspacing: 0;"><tr><td><img style="width: 225; " src="http://orm-chimera-prod.s3.amazonaws.com/1234000000262/figs/0502.png" alt="Interface"></td></tr></table></div></div>
<div class="figure-title">Figure 5-2. Interface</div>
</div>
<p id="other_languages">Other languages have native support for interfaces which may enforce the requirements of an interface. You might know them as abstract base classes, or pure virtual functions.  In JavaScript, there is no distinction between a class, interface, or object instance. There are only object instances, and that simplification is a good  thing. You may be wondering, if there's no native support for interfaces in JavaScript, why bother to write one at all?</p>
<p id="when_you_need_m">When you need multiple implementations of  the same interface, it's good to have a canonical reference in the code that explicitly spells out exactly what that interface is. It's important to write code that is self-documenting. When it's time to add another concrete instance, simply call a predefined factory function and pass in the methods you need to override.</p>
<p id="for_example_us">For example, using O.js to define the factory:</p>
<pre class="programlisting" data-language="js" id="function_expo_id2"><code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">exports</code><code class="p">,</code> <code class="nx">o</code><code class="p">)</code> <code class="p">{</code>
  <code class="s1">'use strict'</code><code class="p">;</code>

  <code class="c1">// Make sure local storage is supported.</code>
  <code class="kd">var</code> <code class="nx">ns</code> <code class="o">=</code> <code class="s1">'post'</code><code class="p">,</code>
    <code class="nx">supportsLocalStorage</code> <code class="o">=</code>
      <code class="p">(</code><code class="k">typeof</code> <code class="nx">localStorage</code> <code class="o">!==</code> <code class="s1">'undefined'</code><code class="p">)</code>
        <code class="o">&amp;&amp;</code> <code class="nx">localStorage</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">,</code>

    <code class="nx">stream</code><code class="p">,</code>

    <code class="c1">// Define the stream interface.</code>
    <code class="nx">streamInterface</code> <code class="o">=</code> <code class="nx">o</code><code class="p">.</code><code class="nx">factory</code><code class="p">({</code>
      <code class="nx">sharedProperties</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStream</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Save the post stream.</code>
        <code class="p">}</code>
      <code class="p">}</code>
    <code class="p">}),</code>

    <code class="nx">localStorageProvider</code> <code class="o">=</code> <code class="nx">streamInterface</code><code class="p">({</code>
      <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStreamLocal</code><code class="p">()</code> <code class="p">{</code>
        <code class="nx">localStorage</code><code class="p">.</code><code class="nx">stream</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">stream</code><code class="p">);</code>
      <code class="p">}</code>
    <code class="p">}),</code>

    <code class="nx">cookieProvider</code> <code class="o">=</code> <code class="nx">streamInterface</code><code class="p">({</code>
      <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStreamCookie</code><code class="p">()</code> <code class="p">{</code>
        <code class="nx">$</code><code class="p">.</code><code class="nx">cookie</code><code class="p">(</code><code class="s1">'stream'</code><code class="p">,</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">stream</code><code class="p">));</code>
      <code class="p">}</code>
    <code class="p">}),</code>

    <code class="c1">// Define the post interface.</code>
    <code class="nx">post</code> <code class="o">=</code> <code class="nx">o</code><code class="p">.</code><code class="nx">factory</code><code class="p">({</code>
      <code class="nx">sharedProperties</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">save</code><code class="p">()</code> <code class="p">{</code>
          <code class="nx">stream</code><code class="p">[</code><code class="k">this</code><code class="p">.</code><code class="nx">id</code><code class="p">]</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code>
          <code class="nx">stream</code><code class="p">.</code><code class="nx">save</code><code class="p">();</code>
          <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
        <code class="p">},</code>
        <code class="nx">set</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">set</code><code class="p">(</code><code class="nx">name</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">this</code><code class="p">.</code><code class="nx">data</code><code class="p">[</code><code class="nx">name</code><code class="p">]</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>
          <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">},</code>
      <code class="nx">defaultProperties</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">data</code><code class="o">:</code> <code class="p">{</code>
          <code class="nx">message</code><code class="o">:</code> <code class="s1">''</code><code class="p">,</code>
          <code class="nx">published</code><code class="o">:</code> <code class="kc">false</code>
        <code class="p">}</code>
      <code class="p">},</code>
      <code class="nx">initFunction</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">initFunction</code><code class="p">()</code> <code class="p">{</code>
        <code class="k">this</code><code class="p">.</code><code class="nx">id</code> <code class="o">=</code> <code class="nx">generateUUID</code><code class="p">();</code>
        <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
      <code class="p">}</code>
    <code class="p">}),</code>

    <code class="nx">api</code> <code class="o">=</code> <code class="nx">post</code><code class="p">;</code>

  <code class="c1">// If localStorage is supported, use it.</code>
  <code class="nx">stream</code> <code class="o">=</code> <code class="p">(</code><code class="nx">supportsLocalStorage</code><code class="p">)</code>
    <code class="o">?</code> <code class="nx">localStorageProvider</code>
    <code class="o">:</code> <code class="nx">cookieProvider</code><code class="p">;</code> <code class="c1">// Fall back on cookies.</code>

  <code class="nx">exports</code><code class="p">[</code><code class="nx">ns</code><code class="p">]</code> <code class="o">=</code> <code class="nx">api</code><code class="p">;</code>

<code class="p">}((</code><code class="k">typeof</code> <code class="nx">exports</code> <code class="o">===</code> <code class="s1">'undefined'</code><code class="p">)</code>
    <code class="o">?</code> <code class="nb">window</code>
    <code class="o">:</code> <code class="nx">exports</code><code class="p">,</code>
  <code class="nx">odotjs</code>
  <code class="p">));</code>

<code class="nx">$</code><code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="s1">'use strict'</code><code class="p">;</code>

  <code class="kd">var</code> <code class="nx">myPost</code> <code class="o">=</code> <code class="nx">post</code><code class="p">().</code><code class="nx">set</code><code class="p">(</code><code class="s1">'message'</code><code class="p">,</code> <code class="s1">'Hello, world!'</code><code class="p">);</code>

  <code class="nx">test</code><code class="p">(</code><code class="s1">'Interface example'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">storedMessage</code><code class="p">,</code>
      <code class="nx">stream</code><code class="p">;</code>

    <code class="nx">myPost</code><code class="p">.</code><code class="nx">save</code><code class="p">();</code>
    <code class="nx">stream</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">stream</code><code class="p">);</code>
    <code class="nx">storedMessage</code> <code class="o">=</code> <code class="nx">stream</code><code class="p">[</code><code class="nx">myPost</code><code class="p">.</code><code class="nx">id</code><code class="p">].</code><code class="nx">message</code><code class="p">;</code>

    <code class="nx">equal</code><code class="p">(</code><code class="nx">storedMessage</code><code class="p">,</code> <code class="s1">'Hello, world!'</code><code class="p">,</code>
      <code class="s1">'.save() method should save post.'</code><code class="p">);</code>
  <code class="p">});</code>
<code class="p">});</code></pre>
<p id="the_important_p">The important part here is the stream interface. First you create the factory (using O.js in this case, but it can be any function that returns an object that demonstrates the interface). This example has only one method: <code class="code">.save()</code></p>
<pre class="programlisting" data-language="js" id="define_the_s">    <code class="c1">// Define the stream interface.</code>
    <code class="nx">streamInterface</code> <code class="o">=</code> <code class="nx">o</code><code class="p">.</code><code class="nx">factory</code><code class="p">({</code>
      <code class="nx">sharedProperties</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStream</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Save the post stream.</code>
        <code class="p">}</code>
      <code class="p">}</code>
    <code class="p">}),</code></pre>
<p id="create_a_concre">Create a concrete implementation by calling the factory function, and passing in the concrete methods. If the interface is especially large, you might want to put each implementation in a separate file. In this case, it's a single one-line method. Notice that the concrete implementations are using named function expressions. During debugging, you'll be able to see which concrete implementation you're using by looking at the function name in the call stack:</p>
<pre class="programlisting" data-language="js" id="localstoragepro">    <code class="nx">localStorageProvider</code> <code class="o">=</code> <code class="nx">streamInterface</code><code class="p">({</code>
      <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStreamLocal</code><code class="p">()</code> <code class="p">{</code>
        <code class="nx">localStorage</code><code class="p">.</code><code class="nx">stream</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">stream</code><code class="p">);</code>
      <code class="p">}</code>
    <code class="p">}),</code>

    <code class="nx">cookieProvider</code> <code class="o">=</code> <code class="nx">streamInterface</code><code class="p">({</code>
      <code class="nx">save</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">saveStreamCookie</code><code class="p">()</code> <code class="p">{</code>
        <code class="nx">$</code><code class="p">.</code><code class="nx">cookie</code><code class="p">(</code><code class="s1">'stream'</code><code class="p">,</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">stream</code><code class="p">));</code>
      <code class="p">}</code>
    <code class="p">}),</code></pre>
<p id="the_final_step_">The final step is to decide which implementation to use:</p>
<pre class="programlisting" data-language="js" id="if_localstor">  <code class="c1">// If localStorage is supported, use it.</code>
  <code class="nx">stream</code> <code class="o">=</code> <code class="p">(</code><code class="nx">supportsLocalStorage</code><code class="p">)</code>
    <code class="o">?</code> <code class="nx">localStorageProvider</code>
    <code class="o">:</code> <code class="nx">cookieProvider</code><code class="p">;</code> <code class="c1">// Fall back on cookies.</code></pre>
<p id="there_are_alter">There are alternative ways to define interfaces in JavaScript. For example, if your concrete implementations are large or resource intensive you may not want to instantiate them until you know they're needed. One way is to move the calls to the factory into the ternary expression. Another is to turn the concrete definitions into factories themselves, and only call the factory corresponding to the implementation you need.</p>
<p id="you_could_also_">You could also define the concrete implementations as prototype objects, and then pass the appropriate prototype into O.js or <code class="code">Object.create()</code> during the final step. I prefer the factory approach, because it gives you a lot of flexibility.</p>
<p id="erich_gamma_on">Erich Gamma, one of the Gang of Four authors who created "Design Patterns", shared some interesting thoughts about interfaces in an interview with Bill Venners: <a class="ulink" href="http://www.artima.com/lejava/articles/designprinciples.html" target="_top">"Leading-Edge Java Design Principles from Design Patterns: A Conversation with Erich Gamma, Part III"</a>.</p>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="the_module_pattern">
<div class="titlepage"><div><div><h2 class="title">The Module Pattern</h2></div></div></div>
<p id="modules_in_the_">Modules in the browser use a wrapping function to encapsulate private data in a closure (for example, with an IIFE, see the section an Immediately Invoked Function Expressions). Without the encapsulated function scope provided by the IIFE, other scripts could try to use the same variable and function names, which could cause a lot of unexpected behavior.</p>
<p id="most_libraries">Most libraries, such as jQuery and Underscore, are encapsulated in modules.</p>
<p id="the_module_patt_id1">The module pattern encapsulates module contents in an immediately invoked function expression (IIFE), and exposes a public interface by assignment. Douglas Crockford gave the module pattern its name, and  Eric Miraglia popularized it in a <a class="ulink" href="http://yuiblog.com/blog/2007/06/12/module-pattern/" target="_top">well-known blog post on the YUI Blog</a>.</p>
<p id="the_original_mo">The original module pattern assigns the result of the IIFE to a predefined namespace variable:</p>
<pre class="programlisting" data-language="js" id="var_mymodule__"><code class="kd">var</code> <code class="nx">myModule</code> <code class="o">=</code> <code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">hello</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">hello</code><code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="s1">'Hello, world!'</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>
<code class="p">}());</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Module pattern'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">equal</code><code class="p">(</code><code class="nx">myModule</code><code class="p">.</code><code class="nx">hello</code><code class="p">(),</code>
    <code class="s1">'Hello, world!'</code><code class="p">,</code>
    <code class="s1">'Module works.'</code><code class="p">);</code>
<code class="p">});</code></pre>
<p id="the_problem_wit_id2">The problem with this pattern is that you have no choice but to expose at least one global variable for each module. If you're building an application with a lot of modules, that is not a good option. Instead, it's possible to pass in an existing variable to extend with your new module.</p>
<p id="here_that_varia">Here that variable is called <code class="code">exports</code>, for compatibility with CommonJS (see the section on Node Modules for an explanation of CommonJS). If <code class="code">exports</code> does not exist, you can fall back on window:</p>
<pre class="programlisting" data-language="js" id="function_expo_id3"><code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">exports</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
      <code class="nx">moduleExists</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">test</code><code class="p">()</code> <code class="p">{</code>
        <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
      <code class="p">}</code>
    <code class="p">};</code>
  <code class="nx">$</code><code class="p">.</code><code class="nx">extend</code><code class="p">(</code><code class="nx">exports</code><code class="p">,</code> <code class="nx">api</code><code class="p">);</code>
<code class="p">}((</code><code class="k">typeof</code> <code class="nx">exports</code> <code class="o">===</code> <code class="s1">'undefined'</code><code class="p">)</code> <code class="o">?</code>
    <code class="nb">window</code> <code class="o">:</code> <code class="nx">exports</code><code class="p">));</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Pass in exports.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">moduleExists</code><code class="p">(),</code>
    <code class="s1">'The module exists.'</code><code class="p">);</code>
<code class="p">});</code></pre>
<p id="a_common_mistak">A common mistake is to pass in a specific application namespace inside your module's source file (instead of using a globally defined exports). Normally, that will not harm anything. However, if you wish to reuse the module in another application, you'll have to modify the source of the module in order to attach it to the correct namespace.</p>
<p id="instead_you_ca">Instead, you can pass your application object in as exports. It's common in client side code to have a build step that wraps all of your modules together in a single outer function. If you pass your application object into that wrapper function as a parameter called <code class="code">exports</code>, you're in business.</p>
<pre class="programlisting" data-language="js" id="var_app___"><code class="kd">var</code> <code class="nx">app</code> <code class="o">=</code> <code class="p">{};</code>

<code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">exports</code><code class="p">)</code> <code class="p">{</code>

  <code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">exports</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">moduleExists</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">test</code><code class="p">()</code> <code class="p">{</code>
          <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">};</code>
    <code class="nx">$</code><code class="p">.</code><code class="nx">extend</code><code class="p">(</code><code class="nx">exports</code><code class="p">,</code> <code class="nx">api</code><code class="p">);</code>
  <code class="p">}((</code><code class="k">typeof</code> <code class="nx">exports</code> <code class="o">===</code> <code class="s1">'undefined'</code><code class="p">)</code> <code class="o">?</code>
      <code class="nb">window</code> <code class="o">:</code> <code class="nx">exports</code><code class="p">));</code>

<code class="p">}(</code><code class="nx">app</code><code class="p">));</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Pass app as exports.'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">app</code><code class="p">.</code><code class="nx">moduleExists</code><code class="p">(),</code>
    <code class="s1">'The module exists.'</code><code class="p">);</code>
<code class="p">});</code></pre>
<p id="an_upside_to_th">An upside to this version of the module pattern is that the code you write with it can be easily run and tested in Node. From this point on, when the module pattern gets mentioned, this is the version that should spring to mind. It's older ancestor is obsolete.</p>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="amd">
<div class="titlepage"><div><div><h2 class="title">AMD</h2></div></div></div>
<p id="on_the_client_s">On the client side, there is often a need to load modules asynchronously at runtime in order to avoid the need for the client to download the entire codebase every time the app is loaded. Imagine you have an app like twitter, where users can post messages or status updates. The core of the application is the messaging feature. However, you also have a large profile editing module that allows users to customize the look of their profile pages.</p>
<p id="users_will_gene">Users will generally update the look of their profiles a few times per year, so the entire profile editing module (all 50,000 lines of it) goes completely unused 99% of the time. What you need is a way to defer the loading of the profile editor until the user actually enters edit mode. You could just make it a separate page, but then the user has to endure a page refresh, when maybe all they wanted to do was change their profile image. It would be a much better experience to keep this all on one page, with no new page load.</p>
<p id="the_module_patt_id2">The module pattern doesn't solve this problem. CommonJS modules (like those used by Node) are  not asynchronous. In the future, JavaScript will have a native module system that works in the browser (see <a class="xref" href="ch05.html#ch9phz70i00005ig1kqp3ed7t" title="Harmony Modules">“Harmony Modules”</a>), but it's very young technology that may not be widely implemented in all major browsers for the foreseeable future.</p>
<p id="asynchronous_mo"><em class="firstterm">Asynchronous Module Definition</em> (AMD) is an interim solution to the problem. It works by wrapping the module inside a function called <code class="code">define()</code>. The call signature looks like this:</p>
<pre class="programlisting" id="definemodulei">define([moduleId,] dependencies, definitionFunction);</pre>
<p id="the_moduleid_pa">The <code class="code">moduleId</code> parameter is a string that will identify the module, however, this parameter has fallen out of favor because changes in the application or module structure can necessitate a refactor, and there really is no need for an ID in the first place. If you leave it out and begin your define call with the dependency list, you'll create a more adaptable <em class="firstterm">anonymous module</em>:</p>
<pre class="programlisting" data-language="js" id="definecha"><code class="nx">define</code><code class="p">([</code><code class="s1">'ch05/amd1'</code><code class="p">,</code> <code class="s1">'ch05/amd2'</code><code class="p">],</code>
  <code class="kd">function</code> <code class="nx">myModule</code><code class="p">(</code><code class="nx">amd1</code><code class="p">,</code> <code class="nx">amd2</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">testResults</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">test1</code><code class="o">:</code> <code class="nx">amd1</code><code class="p">.</code><code class="nx">test</code><code class="p">(),</code>
        <code class="nx">test2</code><code class="o">:</code> <code class="nx">amd2</code><code class="p">.</code><code class="nx">test</code><code class="p">()</code>
      <code class="p">},</code>

      <code class="c1">// Define a public API for your module:</code>
      <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">testResults</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">testResults</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">};</code>

    <code class="k">return</code> <code class="nx">api</code><code class="p">;</code>
  <code class="p">});</code></pre>
<p id="to_kick_it_off">To kick it off, call <code class="code">require()</code>. You specify dependencies similar to <code class="code">define()</code>:</p>
<pre class="programlisting" data-language="js" id="requirech"><code class="nx">require</code><code class="p">([</code><code class="s1">'ch05-amd'</code><code class="p">],</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">amd</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">results</code> <code class="o">=</code> <code class="nx">amd</code><code class="p">.</code><code class="nx">testResults</code><code class="p">();</code>

  <code class="nx">test</code><code class="p">(</code><code class="s1">'AMD with Require.js'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">equal</code><code class="p">(</code><code class="nx">results</code><code class="p">.</code><code class="nx">test1</code><code class="p">,</code> <code class="kc">true</code><code class="p">,</code>
      <code class="s1">'First dependency loaded correctly.'</code><code class="p">);</code>

    <code class="nx">equal</code><code class="p">(</code><code class="nx">results</code><code class="p">.</code><code class="nx">test2</code><code class="p">,</code> <code class="kc">true</code><code class="p">,</code>
      <code class="s1">'Second dependency loaded correctly.'</code><code class="p">);</code>
  <code class="p">});</code>
<code class="p">});</code></pre>
<div class="tip" id="use_anonymous_m_id1"><p id="use_anonymous_m_id2">Use anonymous modules wherever possible in order to avoid refactors.</p></div>
<p id="the_problem_wit_id3">The problem with this approach is that if you define your module this way, it can only be used with an AMD loader, such as Require.js or Curl.js (two popular AMD loaders). However, it is possible to get the best of both AMD and module pattern modules. Simply create your module as you normally would, at the end of the wrapping function, add this:</p>
<pre class="programlisting" data-language="js" id="if_typeof_defi"><code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">define</code> <code class="o">===</code> <code class="s1">'function'</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">define</code><code class="p">([],</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="nx">api</code><code class="p">;</code>
  <code class="p">});</code>
<code class="p">}</code></pre>
<p id="that_way_it_wi">That way, it will be possible to load your module asynchronously if you want to, but your module will still function properly if it's loaded with a simple script tag, or compiled together with a bunch of other modules. This is the pattern that jQuery uses to add AMD loader support. The only trouble with this pattern is that dependency timing is a little more complicated. You'll need to ensure that your dependencies have loaded before you try to use them.</p>
<div class="sect2" id="plugins">
<div class="titlepage"><div><div><h3 class="title">Plugins</h3></div></div></div>
<p id="loader_plugins_">Loader plugins are an AMD mechanism that allow you to load non-JavaScript resources, such as templates, css, etc... Require.js supplies a text! plugin that you can use to load your HTML templates. To use a plugin, simply prefix the file path with the plugin name:</p>
<pre class="programlisting" data-language="js" id="use_strict_r"><code class="s1">'use strict'</code><code class="p">;</code>
<code class="nx">require</code><code class="p">([</code><code class="s1">'ch05/mymodule.js'</code><code class="p">,</code> <code class="s1">'text!ch05/mymodule.html'</code><code class="p">],</code>
    <code class="kd">function</code> <code class="p">(</code><code class="nx">myModule</code><code class="p">,</code> <code class="nx">view</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">container</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">,</code>
    <code class="nx">css</code> <code class="o">=</code> <code class="s1">'ch05/mymodule.css'</code><code class="p">;</code>

  <code class="nx">myModule</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">container</code><code class="p">,</code> <code class="nx">view</code><code class="p">,</code> <code class="nx">css</code><code class="p">);</code>

  <code class="nx">test</code><code class="p">(</code><code class="s1">'AMD Plugins'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="nx">equal</code><code class="p">(</code><code class="nx">$</code><code class="p">(</code><code class="s1">'#mymodule'</code><code class="p">).</code><code class="nx">text</code><code class="p">(),</code> <code class="s1">'Hello, world!'</code><code class="p">,</code>
      <code class="s1">'Plugin loading works.'</code><code class="p">);</code>
  <code class="p">});</code>
<code class="p">});</code></pre>
<p id="heres_what_mym">Here's what <code class="code">mymodule.js</code> looks like:</p>
<pre class="programlisting" data-language="js" id="definefunction"><code class="nx">define</code><code class="p">(</code><code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="s1">'use strict'</code><code class="p">;</code>
  <code class="kd">var</code> <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">render</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">render</code><code class="p">(</code><code class="nx">container</code><code class="p">,</code> <code class="nx">view</code><code class="p">,</code> <code class="nx">css</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">loadCss</code><code class="p">(</code><code class="s1">'ch05/mymodule.css'</code><code class="p">);</code>

      <code class="nx">$</code><code class="p">(</code><code class="nx">view</code><code class="p">).</code><code class="nx">text</code><code class="p">(</code><code class="s1">'Hello, world!'</code><code class="p">)</code>
        <code class="p">.</code><code class="nx">appendTo</code><code class="p">(</code><code class="nx">container</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">};</code>

  <code class="k">return</code> <code class="nx">api</code><code class="p">;</code>
<code class="p">});</code></pre>
<p id="and_the_mymodul">And the <code class="code">mymodule.html</code> template:</p>
<pre class="programlisting" data-language="html" id="div_idmymodu"><code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"mymodule"</code><code class="nt">&gt;&lt;/div&gt;</code></pre>
<p id="the_stylesheet_">The stylesheet is simple:</p>
<pre class="programlisting" data-language="css" id="mymodule__fon"><code class="nf">#mymodule</code> <code class="p">{</code>
  <code class="k">font-size</code><code class="o">:</code><code class="m">2em</code><code class="p">;</code>
  <code class="k">color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code>
<code class="p">}</code></pre>
<p id="note_that_the_c">Note that the css is not loaded as a plugin. Instead, the url is assigned to a variable and passed into the <code class="code">.render()</code> method for manual loading. The <code class="code">loadCSS()</code> function looks like this:</p>
<pre class="programlisting" data-language="js" id="function_loadcs"><code class="kd">function</code> <code class="nx">loadCss</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">$</code><code class="p">(</code><code class="s1">'&lt;link&gt;'</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'text/css'</code><code class="p">,</code>
    <code class="nx">rel</code><code class="o">:</code> <code class="s1">'stylesheet'</code><code class="p">,</code>
    <code class="nx">href</code><code class="o">:</code> <code class="nx">url</code><code class="p">,</code>
  <code class="p">}).</code><code class="nx">appendTo</code><code class="p">(</code><code class="s1">'head'</code><code class="p">);</code>
<code class="p">}</code></pre>
<p id="this_obviously_">This obviously isn't an ideal solution, but as of this writing, there is no standard recommended css! plugin for Require.js. There is a css! plugin for Curl.js, and you might want to try Xstyle. Use them the same way you define the HTML template.</p>
<p id="amd_has_a_coupl">AMD has a couple of serious drawbacks. First, it requires you to include a boilerplate wrapper function for every module, and second, it forces you to either compile your whole application in a compile step, or asynchronously load every single module on the client side, which, in spite of advertising to the contrary,  could actually slow down the load and execution of your scripts due to simultaneous  download limits and connection latency.</p>
<p id="i_recommend_the">I recommend the precompile solution over the asynchronous load solution, and as long as you're doing that anyway, you may as well be using the simplified CommonJS syntax and a tool like Browserify. More on that soon.</p>
</div>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="commonjs_modules">
<div class="titlepage"><div><div><h2 class="title">CommonJS Modules</h2></div></div></div>
<p id="commonjs_is_a_s"> <em class="firstterm">CommonJS</em> is a set of standards for JavaScript environments that attempts to make JavaScript engine implementations more compatible with each other. CommonJS modules specify an API which modules use to declare dependencies. CommonJS module implementations are responsible for reading the modules and resolving those dependencies.</p>
<p id="before_nodejs">Before Node.JS, there were several other attempts to run JavaScript on the server side, as far back as the late 1990's. Both Netscape and Microsoft allowed JavaScript compatible scripting in their server environments. However, few people used those capabilities. The first server side JavaScript solution to gain any real traction was Rhino, but it was too slow and cumbersome to build web scale applications on top of.</p>
<p id="by_the_time_nod">By the time Node.JS arrived on the scene, there were several different server side environments for JavaScript, that all started out using different conventions for dealing with issues such as module loading. CommonJS was created to solve that problem.</p>
<p id="the_commonjs_mo">The CommonJS module system has a much simpler syntax than either the module pattern or AMD. In CommonJS, the file is the module. There is no need for a function wrapper to contain the scope, because each file is given its own scope. Modules declare dependencies with a synchronous <code class="code">require()</code> function. That means that execution is blocked while the required module is being resolved, so it's safe to start using the module immediately after you require it.</p>
<p id="first_assign_t">First, assign to keys on the free variable <code class="code">exports</code> to declare your module's public API:</p>
<pre class="programlisting" data-language="js" id="use_strict_v_id1"><code class="s1">'use strict'</code><code class="p">;</code>
<code class="kd">var</code> <code class="nx">foo</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
<code class="p">};</code>

<code class="nx">exports</code><code class="p">.</code><code class="nx">foo</code> <code class="o">=</code> <code class="nx">foo</code><code class="p">;</code></pre>
<p id="then_use_requir">Then use <code class="code">require()</code> to import your module and assign it to a local variable. You can specify the name of a module in the list of installed Node modules, or specify a path to the module using relative paths.</p>
<p id="for_example_if">For example, if you want to use the Flatiron HTTP Module, you can <code class="code">require()</code> by name. (From the <a class="ulink" href="http://flatironjs.org/#routing" target="_top">Flatiron.js</a> docs):</p>
<pre class="programlisting" data-language="js" id="var_flatiron__"><code class="kd">var</code> <code class="nx">flatiron</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'flatiron'</code><code class="p">),</code>
  <code class="nx">app</code> <code class="o">=</code> <code class="nx">flatiron</code><code class="p">.</code><code class="nx">app</code><code class="p">;</code>

<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">flatiron</code><code class="p">.</code><code class="nx">plugins</code><code class="p">.</code><code class="nx">http</code><code class="p">,</code> <code class="p">{</code>
  <code class="c1">// HTTP options</code>
<code class="p">});</code>

<code class="c1">//</code>
<code class="c1">// app.router is now available. app[HTTP-VERB] is also available</code>
<code class="c1">// as a shortcut for creating routes</code>
<code class="c1">//</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">router</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/version'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">res</code><code class="p">.</code><code class="nx">writeHead</code><code class="p">(</code><code class="mi">200</code><code class="p">,</code> <code class="p">{</code> <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'text/plain'</code> <code class="p">})</code>
  <code class="k">this</code><code class="p">.</code><code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="s1">'flatiron '</code> <code class="o">+</code> <code class="nx">flatiron</code><code class="p">.</code><code class="nx">version</code><code class="p">);</code>
<code class="p">});</code>

<code class="nx">app</code><code class="p">.</code><code class="nx">start</code><code class="p">(</code><code class="mi">8080</code><code class="p">);</code></pre>
<p id="or_specify_a_re">Or specify a relative path:</p>
<pre class="programlisting" data-language="js" id="use_strict_v_id2"><code class="s1">'use strict'</code><code class="p">;</code>
<code class="kd">var</code> <code class="nx">mod</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'./ch05-modules.js'</code><code class="p">),</code>
  <code class="nx">result</code> <code class="o">=</code> <code class="p">(</code><code class="nx">mod</code><code class="p">.</code><code class="nx">foo</code><code class="p">()</code> <code class="o">===</code> <code class="kc">true</code><code class="p">)</code> <code class="o">?</code> <code class="s1">'Pass:'</code> <code class="o">:</code> <code class="s1">'Fail:'</code><code class="p">;</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">result</code><code class="p">,</code> <code class="s1">'.foo() should return true.'</code><code class="p">);</code></pre>
<p id="you_can_use_con">You can use <code class="code">console.log()</code> to simulate a unit testing framework, but there are several better alternatives for Node. See the Chapter "RESTful APIs with Node" for an introduction to unit testing with NodeUnit.</p>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="chejah2xh0000neixiy090gk5">
<div class="titlepage"><div><div><h2 class="title">npm</h2></div></div></div>
<p id="npm_is_a_packag">npm  is a package manager that comes bundled with Node. Contrary to popular belief npm is not an acronym. According to the npm FAQ It provides an easy way to install modules for your application, including all required dependencies. Node relies on the package.json specification for package configuration. It's common to use npm to pull in all of your project's open source JavaScript requirements on the server-side, but there is also a movement forming to use npm to pull in open-source dependencies for the client-side, as well.</p>
<div class="sect2" id="directives">
<div class="titlepage"><div><div><h3 class="title">Directives</h3></div></div></div>
<p id="npm_has_a_numbe">npm has a number of well documented directives, but for the purposes of this book, you'll only need to know the ones you'll commonly need to modify in order to get your typical app up and running:</p>
<div class="itemizedlist" id="name__the_name_id1"><ul class="itemizedlist">
<li class="listitem"><p id="name__the_name_id2"><code class="code">name</code> - The name of the package.</p></li>
<li class="listitem"><p id="version__packa"><code class="code">version</code> - Package version number. npm modules must use semantic versioning.</p></li>
<li class="listitem"><p id="author__some_i"><code class="code">author</code> - Some information about the author.</p></li>
<li class="listitem"><p id="description__a"><code class="code">description</code> - A short description of the package.</p></li>
<li class="listitem"><p id="keywords__sear"><code class="code">keywords</code> - Search terms to help users find the package.</p></li>
<li class="listitem"><p id="main__the_path"><code class="code">main</code> - The path of the main package file.</p></li>
<li class="listitem"><p id="scripts__a_lis"><code class="code">scripts</code> - A list of scripts to expose to <span class="command"><strong>npm</strong></span>. Most projects should define a "test" script that runs with the command <span class="command"><strong>npm test</strong></span>. Use it to execute your unit tests.</p></li>
<li class="listitem"><p id="repository__th"><code class="code">repository</code> - The location of the package repository.</p></li>
<li class="listitem"><p id="dependencies_b"><code class="code">dependencies, bundledDependencies</code> - Dependencies your package will <code class="code">require()</code>. </p></li>
<li class="listitem"><p id="devdependencies"><code class="code">devDependencies</code> - A list of dependencies that developers will need in order to contribute.</p></li>
<li class="listitem"><p id="engines__speci"><code class="code">engines</code> - Specifies which version of Node to use.</p></li>
</ul></div>
<p id="if_you_want_to_">If you want to build a node app, one of the first things you'll need to do is create a server. One of the easiest ways to do that is to use Express, a minimal application framework for Node. Before you begin, you should look at the latest version available. By the time you read this, the version you see here should no longer be the latest:</p>
<p id="npm_info_expr"><strong class="userinput"><code>$ npm info express</code></strong></p>
<p id="rc"><code class="computeroutput">3.0.0rc5</code></p>
<p id="now_you_can_add">Now you can add it to your <code class="code">package.json</code> file:</p>
<div class="example" id="packagejson">
<div class="example-title">Example 5-1. package.json</div>
<div class="example-contents"><pre class="programlisting" data-language="json" id="name_simp"><code class="p">{</code>
  <code class="nt">"name"</code><code class="p">:</code> <code class="s2">"simple-express-static-server"</code><code class="p">,</code>
  <code class="nt">"version"</code><code class="p">:</code> <code class="s2">"0.1.0"</code><code class="p">,</code>
  <code class="nt">"author"</code><code class="p">:</code> <code class="s2">"Sandro Padin"</code><code class="p">,</code>
  <code class="nt">"description"</code><code class="p">:</code> <code class="s2">"A very simple static file server. For development use only."</code><code class="p">,</code>
  <code class="nt">"keywords"</code><code class="p">:</code> <code class="p">[</code><code class="s2">"http"</code><code class="p">,</code> <code class="s2">"web server"</code><code class="p">,</code> <code class="s2">"static server"</code><code class="p">],</code>
  <code class="nt">"main"</code><code class="p">:</code> <code class="s2">"./server.js"</code><code class="p">,</code>
  <code class="nt">"scripts"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"start"</code><code class="p">:</code> <code class="s2">"node ./server.js"</code>
  <code class="p">},</code>
  <code class="nt">"repository"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"type"</code><code class="p">:</code> <code class="s2">"git"</code><code class="p">,</code>
    <code class="nt">"url"</code><code class="p">:</code> <code class="s2">"https://github.com/spadin/simple-express-static-server.git"</code>
  <code class="p">},</code>
  <code class="nt">"dependencies"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"express"</code><code class="p">:</code> <code class="s2">"3.0.x"</code>
  <code class="p">},</code>
  <code class="nt">"engines"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"node"</code><code class="p">:</code> <code class="s2">"&gt;=0.6"</code>
  <code class="p">}</code>
<code class="p">}</code></pre></div>
</div>
<p id="notice_that_the_id2">Notice that the express version is specified as "<code class="code">3.0.x</code>". The <code class="code">x</code> acts like a wildcard. It will install the latest 3.0 version, regardless of the patch number. It's another way of saying, "give me bug fixes, but no API changes". Node modules use <a class="ulink" href="http://semver.org/" target="_top">Semantic Versioning</a>. Read it as Major.Minor.Patch. Working backwards, bug fixes increment the patch version, non-breaking API changes increment the minor version, and backward breaking changes increment the major version. A zero for the major version indicates initial development. The public API should not be considered stable, and there is no indication in the version string for backward-breaking changes.</p>
<p id="now_that_your_p">Now that your package and dependencies are declared, return to the console and run:</p>
<p id="npm_install_id1"><strong class="userinput"><code>$ npm install</code></strong></p>
<pre class="screen" id="expressrc">express@3.0.0rc5 node_modules/express
├── methods@0.0.1
├── fresh@0.1.0
├── range-parser@0.0.4
├── cookie@0.0.4
├── crc@0.2.0
├── commander@0.6.1
├── debug@0.7.0
├── mkdirp@0.3.3
├── send@0.1.0 (mime@1.2.6)
└── connect@2.5.0 (pause@0.0.1, bytes@0.1.0, send@0.0.4, formidable@1.0.11, qs@0.5.1)
</pre>
<p id="when_you_run_np">When you run <span class="command"><strong>npm install</strong></span>, it will look at <code class="code">package.json</code> and install all of the dependencies for you, including those that were declared by the <code class="code">express</code> package.</p>
</div>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="ch9phz70i00005ig1kqp3ed7t">
<div class="titlepage"><div><div><h2 class="title">Harmony Modules</h2></div></div></div>
<p id="none_of_the_mod">None of the module systems discussed so far are included in the official ECMAScript specifications. In the future, a module system will be built-in to all ECMA-compliant  JavaScript engines.</p>
<p id="the_harmony_mod">The Harmony module specification hasn't stabilized yet, but when it does, it should be possible to write harmony modules and compile using build tools to fall back on the module pattern, AMD, and CommonJS where required.</p>
<p id="harmony_module_">Harmony module build tools are already beginning to appear, but since the specification is likely to change, you should probably wait a bit longer before you start to rely on them for your production applications.</p>
</div>
<div class="sect1" data-original-filename="ch05.xml" id="building_clientside_code_with_commonjs_npm_grunt_and_browserify">
<div class="titlepage"><div><div><h2 class="title">Building Client-Side Code With CommonJS, npm, Grunt, and Browserify</h2></div></div></div>
<p id="there_are_a_var">There are a variety of competing standards for module management with JavaScript, but due to the popularity of Node, by far the most established is npm + CommonJS. There have been efforts to create a similar combination of features for the client-side, including AMD, <a class="ulink" href="http://yeoman.io/" target="_top">Yeoman</a>, and <a class="ulink" href="http://yeoman.io/packagemanager.html" target="_top">Bower</a>, but none of them can compete with the simplicity and package availability of npm and CommonJS modules.</p>
<p id="to_demonstrate">To demonstrate, take a look at how you might build a minimal client-side guestlist app (just in case you need a bouncer at your birthday party).</p>
<div class="sect2" id="defining_the_app">
<div class="titlepage"><div><div><h3 class="title">Defining the App</h3></div></div></div>
<p id="most_new_softwa">Most new software projects use agile development methods to produce quick software creation and enhancement iterations. In agile software, the time between releases is measured in days or weeks rather than months or years. To learn more about agile, see [<span class="citation">The Art of Agile Development: Pragmatic guide to agile software development</span>],  by James Shore, Chromatic.</p>
<p id="typically_when_">Typically when you set out to build an app, you'll start with a list of <em class="firstterm">user stories</em>. You can use those scenarios to come up with <em class="firstterm">acceptance criteria</em>, which can be further distilled into functional unit tests. </p>
<p id="a_user_story_is">A user story is a short, simple description of some action that your user might want to perform.  For example,  "As an event organizer, I want to check arriving guests against the guestlist." User stories should always contain a role along with the story. Answer the questions, "who is performing the action?" and "what is the user trying to accomplish?"</p>
<p id="to_express_this">To express this example story in code, you'll need a list element with clickable links in list items. The unit tests might look something like this:</p>
<div class="example" id="guestlisttesttestjs">
<div class="example-title">Example 5-2. guestlist/test/test.js</div>
<div class="example-contents"><pre class="programlisting" data-language="js" id="var_list__"><code class="kd">var</code> <code class="nx">$list</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'#guestlist-view'</code><code class="p">),</code>
  <code class="nx">checkedinClass</code> <code class="o">=</code> <code class="s1">'icon-check'</code><code class="p">,</code>
  <code class="nx">guestSelector</code> <code class="o">=</code> <code class="s1">'.guest'</code><code class="p">;</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Guestlist'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">$list</code><code class="p">.</code><code class="nx">length</code><code class="p">,</code>
    <code class="s1">'List element should have guests.'</code><code class="p">);</code>
<code class="p">});</code>

<code class="nx">test</code><code class="p">(</code><code class="s1">'Guests'</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>

  <code class="c1">// Grab the first guest from the list</code>
  <code class="kd">var</code> <code class="nx">$guest</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="nx">$list</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="nx">guestSelector</code><code class="p">)[</code><code class="mi">0</code><code class="p">]),</code>
    <code class="nx">guestExists</code> <code class="o">=</code> <code class="o">!!</code><code class="nx">$guest</code><code class="p">[</code><code class="mi">0</code><code class="p">];</code>

  <code class="c1">// Simulate click</code>
  <code class="nx">$guest</code><code class="p">.</code><code class="nx">click</code><code class="p">();</code>

  <code class="nx">ok</code><code class="p">(</code><code class="nx">$guest</code><code class="p">.</code><code class="nx">hasClass</code><code class="p">(</code><code class="nx">checkedinClass</code><code class="p">),</code>
      <code class="s1">'Should be checked on click'</code><code class="p">);</code>

  <code class="nx">$guest</code><code class="p">.</code><code class="nx">click</code><code class="p">();</code>

  <code class="c1">// To avoid a false positive, make sure</code>
  <code class="c1">// you have a guest element to test against.</code>
  <code class="nx">ok</code><code class="p">(</code><code class="nx">guestExists</code> <code class="o">&amp;&amp;</code> <code class="o">!</code><code class="nx">$guest</code><code class="p">.</code><code class="nx">hasClass</code><code class="p">(</code><code class="nx">checkedinClass</code><code class="p">),</code>
      <code class="s1">'Should toggle off when clicked again'</code><code class="p">);</code>
<code class="p">});</code>
</pre></div>
</div>
<p id="youll_need_to_">You'll need to include that in your QUnit HTML file:</p>
<div class="example" id="guestlisttestindexhtml">
<div class="example-title">Example 5-3. guestlist/test/index.html</div>
<div class="example-contents"><pre class="programlisting" data-language="html" id="doctype_html"><code class="cp">&lt;!DOCTYPE html&gt;</code>
  <code class="nt">&lt;html&gt;</code>
    <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;/head&gt;</code>
    <code class="nt">&lt;body&gt;</code>
      <code class="nt">&lt;section&gt;</code>
        <code class="nt">&lt;h1</code> <code class="na">id=</code><code class="s">"qunit-header"</code><code class="nt">&gt;</code>QUnit Test Suite<code class="nt">&lt;/h1&gt;</code>  
        <code class="nt">&lt;h2</code> <code class="na">id=</code><code class="s">"qunit-banner"</code><code class="nt">&gt;&lt;/h2&gt;</code>  
        <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"qunit-testrunner-toolbar"</code><code class="nt">&gt;&lt;/div&gt;</code>  
        <code class="nt">&lt;h2</code> <code class="na">id=</code><code class="s">"qunit-userAgent"</code><code class="nt">&gt;&lt;/h2&gt;</code>  
        <code class="nt">&lt;ol</code> <code class="na">id=</code><code class="s">"qunit-tests"</code><code class="nt">&gt;&lt;/ol&gt;</code>
      <code class="nt">&lt;/section&gt;</code>

      <code class="nt">&lt;section</code> <code class="na">id=</code><code class="s">"container"</code><code class="nt">&gt;&lt;/section&gt;</code>

      <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"jquery.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
      <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"qunit.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
      <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"../public/app.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
      <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"test.js"</code><code class="nt">&gt;&lt;/script&gt;</code>
      <code class="nt">&lt;link</code> <code class="na">href=</code><code class="s">"qunit.css"</code> <code class="na">rel=</code><code class="s">"stylesheet"</code><code class="nt">&gt;&lt;/style&gt;</code>

    <code class="nt">&lt;/body&gt;</code>
  <code class="nt">&lt;/html&gt;</code>
</pre></div>
</div>
<p id="these_tests_wil">These tests will obviously fail at first. That's a good thing. If you can see your tests fail before you make them pass, you eliminate the possibility that your test results are showing you false positives. For this reason, <em class="firstterm">TDD</em> (Test Driven Development) proponents advocate writing your unit tests before you implement the code that they're written against. Because you're writing from an API user perspective when you write tests first, using test driven development forces you to write more modular, testable code. You may also notice that your APIs are easier to use because you're not worried about implementation details when you write your tests -- you won't accidentally leak implementation details into your APIs.</p>
<p id="in_fact_while_">In fact, while I was writing this example, I started with the tests above, and then decided to implement the features. I was tempted to use some Twitter Bootstrap controls out of the box to implement my styles, but that would have forced me to expose unnecessary markup details in the API because Bootstrap makes assumptions about the tags you'll use to implement controls. As a result, I adapted the stylesheet to pass the tests, and the API is better for it. Had I not written failing tests first, I might have accepted the extra markup, and over-complicated the example, and then written tests that passed against the inferior implementation.</p>
<div class="tip" id="twitter_bootstr_id1">
<p id="twitter_bootstr_id2">Twitter Bootstrap is a popular CSS framework that is sometimes useful for prototyping web applications quickly. It's a good idea to play with it and see if it would be useful to you. Remember though that it's designed to be tweaked and customized. Don't feel like you have to conform to the default markup and classes if they don't fit your particular use-case.
          </p>
<p id="theres_a_runni">There's a running joke about how many sites look the same because they use all the same Bootstrap styles and controls. You may want to mix it up a little. There's an interesting blog post on the topic called, <a class="ulink" href="http://antjanus.com/blog/web-design-tips/user-interface-usability/customize-twitter-bootstrap-into-themes/" target="_top">"Customize Twitter Bootstrap To Not Look Bootstrap-y" by Antonin Januska.</a></p>
</div>
<p id="time_to_see_the">Time to see the test output from QUnit:</p>
<div class="figure" id="failing_qunit_screenshot">
<div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 432; cellpadding: 0; cellspacing: 0;"><tr><td><img style="width: 432; " src="http://orm-chimera-prod.s3.amazonaws.com/1234000000262/figs/0503.tiff" alt="Failing QUnit Screenshot"></td></tr></table></div></div>
<div class="figure-title">Figure 5-3. Failing QUnit Screenshot</div>
</div>
<p id="failing_tests_w">Failing tests will be listed in red. To make the tests turn green, you'll need to implement the features. Normally it's wise to break the code up into separate concerns. There's a lot more on that topic in <a class="xref" href="ch06.html" title="Chapter 6. Separation of Concerns">Chapter 6</a>.  In this case, you'll separate presentation concerns from data management. The data will come from a stubbed model module named <code class="code">guestlistmodel.js</code>. For now it will just return some hard-coded names. You can implement loading and saving later:</p>
<div class="example" id="guestlistsrcguestlistmodeljs">
<div class="example-title">Example 5-4. guestlist/src/guestlistmodel.js</div>
<div class="example-contents"><pre class="programlisting" data-language="js" id="var_api___loa"><code class="kd">var</code> <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">load</code><code class="o">:</code> <code class="kd">function</code> <code class="nx">load</code><code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="p">[</code>
        <code class="s1">'Jimi Hendrix'</code><code class="p">,</code>
        <code class="s1">'Billie Holiday'</code><code class="p">,</code>
        <code class="s1">'Nina Simone'</code><code class="p">,</code>
        <code class="s1">'Jim Morrison'</code><code class="p">,</code>
        <code class="s1">'Duke Ellington'</code><code class="p">,</code>
        <code class="s1">'John Bonham'</code>
      <code class="p">];</code>
    <code class="p">}</code>
  <code class="p">};</code>

<code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">api</code><code class="p">;</code>
</pre></div>
</div>
<p id="as_you_can_see_id7">As you can see, this file is pretty straightforward. It just defines an <code class="code">api</code> object and sets it on <code class="code">module.exports</code>  to expose it to other modules in accordance with the CommonJS specification.</p>
<p id="the_code_to_man">The code to manipulate the list DOM elements will go into a file named <code class="code">guestlistview.js</code>:</p>
<div class="example" id="guestlistsrcguestlistviewjs">
<div class="example-title">Example 5-5. guestlist/src/guestlistview.js</div>
<div class="example-contents"><pre class="programlisting" data-language="js" id="var___require_id1"><code class="kd">var</code> <code class="nx">$</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'jquery-browserify'</code><code class="p">),</code>
  <code class="nx">checkedinClass</code> <code class="o">=</code> <code class="s1">'icon-check'</code><code class="p">,</code>
  <code class="nx">listClass</code> <code class="o">=</code> <code class="s1">'dropdown-menu'</code><code class="p">,</code>
  <code class="nx">guestClass</code> <code class="o">=</code> <code class="s1">'guest'</code><code class="p">,</code>

  <code class="nx">toggleCheckedIn</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">toggleCheckedIn</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">$</code><code class="p">(</code><code class="k">this</code><code class="p">).</code><code class="nx">toggleClass</code><code class="p">(</code><code class="nx">checkedinClass</code><code class="p">);</code>
  <code class="p">},</code>

  <code class="nx">$listView</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'&lt;ol&gt;'</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s1">'guestlist-view'</code><code class="p">,</code>
    <code class="s1">'class'</code><code class="o">:</code> <code class="nx">listClass</code>
  <code class="p">}).</code><code class="nx">on</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="s1">'.'</code> <code class="o">+</code> <code class="nx">guestClass</code><code class="p">,</code> <code class="nx">toggleCheckedIn</code><code class="p">),</code>

  <code class="nx">render</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">render</code><code class="p">(</code><code class="nx">guestlist</code><code class="p">)</code> <code class="p">{</code>

    <code class="nx">$listView</code><code class="p">.</code><code class="nx">empty</code><code class="p">();</code>

    <code class="nx">guestlist</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">guest</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">$guest</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'&lt;li class="'</code> <code class="o">+</code> <code class="nx">guestClass</code> <code class="o">+</code> <code class="s1">'"&gt;'</code> <code class="o">+</code> 
        <code class="s1">'&lt;span class="name"&gt;'</code> <code class="o">+</code> <code class="nx">guest</code> <code class="o">+</code> 
        <code class="s1">'&lt;/span&gt;&lt;/li&gt;'</code><code class="p">);</code>
      <code class="nx">$guest</code><code class="p">.</code><code class="nx">appendTo</code><code class="p">(</code><code class="nx">$listView</code><code class="p">);</code>
    <code class="p">});</code>

    <code class="k">return</code> <code class="nx">$listView</code><code class="p">;</code>
  <code class="p">},</code>

  <code class="nx">api</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">render</code><code class="o">:</code> <code class="nx">render</code>
  <code class="p">};</code>

<code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">api</code><code class="p">;</code>
</pre></div>
</div>
<p id="this_is_the_fil">This is the file doing all the work. First it uses <code class="code">.require()</code> to get a reference to jQuery, and sets a few self-documenting variable names. The <code class="code">toggleCheckedIn()</code> function is an event handler for the <code class="code">click</code> event.</p>
<p id="the_list_elemen">The list element gets added. Note that it's using jQuery's <code class="code">.on()</code> method to delegate the click events. <code class="code">.on()</code> is the recently recommended way to hook up event handlers in jQuery. It replaces the deprecated <code class="code">.bind()</code>, <code class="code">.live()</code>, and <code class="code">.delegate()</code> methods with a simplified syntax, and more consistent signature.</p>
<div class="tip" id="by_delegating_t_id1"><p id="by_delegating_t_id2">By delegating to the parent ordered list element, you can replace, remove, and add children to the list without worrying about removing and replacing event listeners. There won't be any memory leaks, and you don't have to wait until the whole list is rendered before you attach the listener. If you're hooking up listeners to DOM elements, most of the time, delegating to an ancestor is the right approach.</p></div>
<p id="the_render_m">The <code class="code">.render()</code> method takes an array of guest names, iterates over each one, and adds a corresponding list item to the <code class="code">$listView</code> element. It then returns the rendered element to the calling function.</p>
<p id="the_rest_of_the">The rest of the code simply defines the public API and exposes it via CommonJS.</p>
<div class="tip" id="some_developers_id1"><p id="some_developers_id2">Some developers will intersperse <code class="code">module.exports</code> assignments throughout a module. I find that having a single <code class="code">module.exports</code> at the bottom of the file more clearly documents the module's public API.</p></div>
<p id="so_far_the_mod">So far, the modules don't know about each other, so there's no way for them to do any work. To bring all the pieces together and manage the initial render, you'll need a higher level abstraction to kick things off. Enter <code class="code">app.js</code>:</p>
<div class="example" id="guestlistsrcappjs">
<div class="example-title">Example 5-6. guestlist/src/app.js</div>
<div class="example-contents"><pre class="programlisting" data-language="js" id="var___require_id2"><code class="kd">var</code> <code class="nx">$</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'jquery-browserify'</code><code class="p">),</code>
  <code class="nx">guestlistModel</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'./guestlistmodel'</code><code class="p">),</code>
  <code class="nx">guestlistView</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'./guestlistview'</code><code class="p">),</code>
  <code class="nx">$container</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s1">'#container'</code><code class="p">);</code>

<code class="nx">$</code><code class="p">(</code><code class="kd">function</code> <code class="nx">init</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">var</code> <code class="nx">guestlistData</code> <code class="o">=</code> <code class="nx">guestlistModel</code><code class="p">.</code><code class="nx">load</code><code class="p">();</code>
    <code class="nx">$guestlist</code> <code class="o">=</code> <code class="nx">guestlistView</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">guestlistData</code><code class="p">);</code>
  <code class="nx">$container</code><code class="p">.</code><code class="nx">empty</code><code class="p">().</code><code class="nx">append</code><code class="p">(</code><code class="nx">$guestlist</code><code class="p">);</code>
<code class="p">});</code>
</pre></div>
</div>
<p id="this_one_should">This one should be fairly simple to follow. It uses <code class="code">.require()</code> to reference <code class="code">guestlistModel</code> and <code class="code">guestlistView</code>, loads the guestlist, passes the data into <code class="code">guestlistView.render()</code>, and adds it to the <code class="code">container</code> element.</p>
<div class="tip" id="the_append_l_id1"><p id="the_append_l_id2">The <code class="code">.append()</code> line at the end of the <code class="code">init()</code> function calls jQuery's <code class="code">.empty()</code> method first for a couple of important reasons: First, if there's anything in that space already, it should be replaced, but it also releases references to event listeners so that the memory can be garbage collected. This is a better strategy than simply calling <code class="code">.html()</code>. The latter is by far the more popular method, but it can be a major source of bugs and confusion when you start to develop large, client-heavy applications in JavaScript.</p></div>
<p id="none_of_this_is">None of this is going to work yet, because the modules all need to be compiled together in order of their dependencies. For that, you'll need Browserify.</p>
<p id="browserify_is_a"><a class="ulink" href="https://github.com/substack/node-browserify" target="_top">Browserify</a> is a Node module that makes CommonJS modules work in the browser, using a server-side build step. The <code class="code">browserify</code> command is available to kick off the bundle:</p>
<pre class="programlisting" data-language="console" id="browserify_sr"><code class="gp">$</code> browserify src/app.js -o public/app.js</pre>
<p id="thats_a_bit_to">That's a bit too manual, though. You'll want to use <code class="code">grunt</code> to automate the build. That way you can lint, build, and run your unit tests all in one step. Start with <code class="code">package.json</code>:</p>
<div class="example" id="guestlistpackagejson">
<div class="example-title">Example 5-7. guestlist/package.json</div>
<div class="example-contents"><pre class="programlisting" data-language="json" id="name_gues"><code class="p">{</code>
  <code class="nt">"name"</code><code class="p">:</code> <code class="s2">"guestlist"</code><code class="p">,</code>
  <code class="nt">"version"</code><code class="p">:</code> <code class="s2">"0.1.0"</code><code class="p">,</code>
  <code class="nt">"author"</code><code class="p">:</code> <code class="s2">"Eric Elliott"</code><code class="p">,</code>
  <code class="nt">"description"</code><code class="p">:</code> <code class="s2">"A handy tool for bouncers."</code><code class="p">,</code>
  <code class="nt">"keywords"</code><code class="p">:</code> <code class="p">[</code><code class="s2">"party"</code><code class="p">,</code> <code class="s2">"guestlist"</code><code class="p">],</code>
  <code class="nt">"main"</code><code class="p">:</code> <code class="s2">"dist/app.js"</code><code class="p">,</code>
  <code class="nt">"scripts"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"test"</code><code class="p">:</code> <code class="s2">"grunt test"</code>
  <code class="p">},</code>
  <code class="nt">"dependencies"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"jquery-browserify"</code><code class="p">:</code> <code class="s2">"*"</code>
  <code class="p">},</code>
  <code class="nt">"devDependencies"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"traverse"</code><code class="p">:</code> <code class="s2">"*"</code><code class="p">,</code>
    <code class="nt">"grunt"</code><code class="p">:</code> <code class="s2">"*"</code><code class="p">,</code>
    <code class="nt">"grunt-browserify"</code><code class="p">:</code> <code class="s2">"*"</code><code class="p">,</code>
    <code class="nt">"browserify"</code><code class="p">:</code> <code class="s2">"*"</code>    
  <code class="p">},</code>
  <code class="nt">"engines"</code><code class="p">:</code> <code class="p">{</code>
    <code class="nt">"node"</code><code class="p">:</code> <code class="s2">"&gt;=0.6"</code>
  <code class="p">}</code>
<code class="p">}</code>
</pre></div>
</div>
<p id="since_youll_be">Since you'll be deploying this app, you should consider all of the code it uses to be part of the app, including its dependencies. You don't want those dependency versions shifting around under your feet during your deploy step. The less uncertainty and moving parts you have in a deploy step the better. For that reason, you're going to want to check in your <code class="code">node_modules</code> directory (don't add it to <code class="code">.gitignore</code>).</p>
<p id="because_all_of_">Because all of the dependencies are going to be checked into the repository, you don't need to specify the versions to install. The "<code class="code">*</code>" indicates that you want to use the latest version.</p>
<p id="youll_also_nee">You'll also need a gruntfile. Currently the latest stable version of <code class="code">grunt</code> looks for <code class="code">grunt.js</code> by default. That's changed in the current alpha version, so you might need to use <code class="code">gruntfile.js</code> as the filename. Here's what it looks like:</p>
<div class="example" id="guestlistgruntjs">
<div class="example-title">Example 5-8. guestlist/grunt.js</div>
<div class="example-contents"><pre class="programlisting" data-language="js" id="global_module"><code class="cm">/*global module*/</code>
<code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">grunt</code><code class="p">)</code> <code class="p">{</code>
  <code class="s1">'use strict'</code><code class="p">;</code>
  <code class="nx">grunt</code><code class="p">.</code><code class="nx">initConfig</code><code class="p">({</code>

    <code class="c1">// Read package.json into an object for later</code>
    <code class="c1">// reference (for example, in meta, below).</code>
    <code class="nx">pkg</code><code class="o">:</code> <code class="s1">'&lt;json:package.json&gt;'</code><code class="p">,</code>

    <code class="nx">meta</code><code class="o">:</code> <code class="p">{</code>

      <code class="c1">// A template to add to the top of the bundled</code>
      <code class="c1">// output.</code>
      <code class="nx">banner</code><code class="o">:</code> <code class="s1">'\n/*! &lt;%= pkg.title || pkg.name %&gt; '</code> <code class="o">+</code>
        <code class="s1">'- v&lt;%= pkg.version %&gt; - '</code> <code class="o">+</code>
        <code class="s1">'&lt;%= grunt.template.today("yyyy-mm-dd") %&gt;\n '</code> <code class="o">+</code>
        <code class="s1">'&lt;%= pkg.homepage ? "* " + pkg.homepage + "\n'</code> <code class="o">+</code>
        <code class="s1">' *\n " : "" %&gt;'</code> <code class="o">+</code>
        <code class="s1">'* Copyright (c) '</code> <code class="o">+</code>
        <code class="s1">'&lt;%= grunt.template.today("yyyy") %&gt; '</code> <code class="o">+</code>
        <code class="s1">'&lt;%= pkg.author.name %&gt;;\n'</code> <code class="o">+</code>
        <code class="s1">' * Licensed under the &lt;%= '</code> <code class="o">+</code>
        <code class="s1">'_.pluck(pkg.licenses, "type").join(", ") %&gt;'</code> <code class="o">+</code>
        <code class="s1">' license */'</code>
    <code class="p">},</code>

    <code class="c1">// Specify which files to send through JSHint.</code>
    <code class="nx">lint</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">all</code><code class="o">:</code> <code class="p">[</code><code class="s1">'./grunt.js'</code><code class="p">,</code> <code class="s1">'./src/**/*.js'</code><code class="p">,</code>
        <code class="s1">'./test-src/test.js'</code><code class="p">]</code>
    <code class="p">},</code>

    <code class="c1">// JSHint configuration options.</code>
    <code class="nx">jshint</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">browser</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
      <code class="nx">node</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">strict</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
      <code class="nx">curly</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">eqeqeq</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">immed</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">latedef</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">newcap</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">nonew</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">noarg</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">sub</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">undef</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">unused</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">eqnull</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
      <code class="nx">boss</code><code class="o">:</code> <code class="kc">false</code>
    <code class="p">},</code>

    <code class="c1">// Specify test locations for QUnit.</code>
    <code class="nx">qunit</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">browser</code><code class="o">:</code> <code class="p">[</code><code class="s1">'test/index.html'</code><code class="p">]</code>
    <code class="p">},</code>

    <code class="c1">// Configuration for browserify.</code>
    <code class="nx">browserify</code><code class="o">:</code> <code class="p">{</code>
      <code class="s2">"public/app.js"</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">requires</code><code class="o">:</code> <code class="p">[</code><code class="s1">'traverse'</code><code class="p">],</code>
        <code class="nx">entries</code><code class="o">:</code> <code class="p">[</code><code class="s1">'src/**/*.js'</code><code class="p">],</code>
        <code class="nx">prepend</code><code class="o">:</code> <code class="p">[</code><code class="s1">'&lt;banner:meta.banner&gt;'</code><code class="p">],</code>
        <code class="nx">append</code><code class="o">:</code> <code class="p">[],</code>
        <code class="nx">hook</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
          <code class="c1">// bundle is passed in as first param</code>
        <code class="p">}</code>
      <code class="p">}</code>
    <code class="p">}</code>

  <code class="p">});</code>

  <code class="c1">// Load browserify tasks. Needed for bundling.</code>
  <code class="nx">grunt</code><code class="p">.</code><code class="nx">loadNpmTasks</code><code class="p">(</code><code class="s1">'grunt-browserify'</code><code class="p">);</code>

  <code class="c1">// Setup command line argument tasks. For e.g.:</code>
  <code class="c1">// $ grunt # executes lint, browserify, qunit</code>
  <code class="c1">// $ grunt test # runs qunit task, only.</code>
  <code class="nx">grunt</code><code class="p">.</code><code class="nx">registerTask</code><code class="p">(</code><code class="s1">'default'</code><code class="p">,</code> <code class="s1">'lint browserify qunit'</code><code class="p">);</code>
  <code class="nx">grunt</code><code class="p">.</code><code class="nx">registerTask</code><code class="p">(</code><code class="s1">'install'</code><code class="p">,</code> <code class="s1">'browserify'</code><code class="p">);</code>
  <code class="nx">grunt</code><code class="p">.</code><code class="nx">registerTask</code><code class="p">(</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'qunit'</code><code class="p">);</code>
<code class="p">};</code></pre></div>
</div>
<p id="the_grunt_confi">The Grunt configuration file is just a Node JavaScript module, so you can write functions in it, evaluate expressions, and so on. </p>
<p id="browserify_requ">Browserify requires a little extra configuration sometimes. Please refer to the <code class="code">
          <a class="ulink" href="https://github.com/pix/grunt-browserify" target="_top">grunt-browserify</a>
        </code> documentation for specific settings. Just don't forget to load the grunt tasks with <code class="code">grunt.loadNpmTasks('grunt-browserify')</code>.</p>
<p id="the_registerta">The <code class="code">.registerTask()</code> calls make grunt command line arguments available. For example, all the <code class="code">default</code> tasks will run when you execute <code class="code">grunt</code> without any arguments, and <code class="code">grunt test</code> will only run the tests.</p>
<p id="time_for_some_a">Time for some action:</p>
<pre class="screen" id="grunt_running">$ grunt
Running "lint:all" (lint) task
Lint free.

Running "browserify:public/app.js" (browserify) task

Running "qunit:browser" (qunit) task
Testing index.html..OK
&gt;&gt; 3 assertions passed (32ms)

Done, without errors.
</pre>
<p id="notice_the_quni">Notice the QUnit task output. The tests are green, and in this form, you can run them on an automated continuous integration system.</p>
<p id="in_case_youre_">In case you're curious, the browser output looks like this:</p>
<div class="figure" id="passing_qunit_screenshot">
<div class="figure-contents"><div class="mediaobject"><table style="border: 0; width: 432; cellpadding: 0; cellspacing: 0;"><tr><td><img style="width: 432; " src="http://orm-chimera-prod.s3.amazonaws.com/1234000000262/figs/0504.tiff" alt="Passing QUnit Screenshot"></td></tr></table></div></div>
<div class="figure-title">Figure 5-4. Passing QUnit Screenshot</div>
</div>
<p id="in_general_css">In general, CSS is a little outside the scope of this book, but there are a few tips you should be aware of. For some great ideas on how to use CSS for applications, see <a class="ulink" href="http://smacss.com/" target="_top">[<span class="citation">Scalable and Modular Architecture for CSS</span>], by Jonathan Snook</a>.</p>
<p id="the_guestlist_c">The Guestlist code employs a custom icon font for the checkbox. Fonts provide a major advantage over traditional methods like <code class="code">png</code> icons. For instance, they are infinitely scaleable, and you can apply any CSS you'd normally apply to text. You can also create a single, custom font that is easy for clients to download. The font was created using a free custom font app called <a class="ulink" href="http://icomoon.io/" target="_top">IcoMoon</a>. The icon font related CSS looks like this:</p>
<div class="example" id="icon_font_css">
<div class="example-title">Example 5-9. Icon Font CSS</div>
<div class="example-contents"><pre class="programlisting" data-language="css" id="fontface__fo"><code class="k">@font-face</code> <code class="p">{</code>
  <code class="nt">font-family</code><code class="o">:</code> <code class="s1">'guestlist'</code><code class="o">;</code>
  <code class="nt">src</code><code class="nd">:url</code><code class="o">(</code><code class="s1">'fonts/guestlist.eot'</code><code class="o">);</code>
  <code class="nt">src</code><code class="nd">:url</code><code class="o">(</code><code class="s1">'fonts/guestlist.eot?#iefix'</code><code class="o">)</code>
      <code class="nt">format</code><code class="o">(</code><code class="s1">'embedded-opentype'</code><code class="o">),</code>
    <code class="nt">url</code><code class="o">(</code><code class="s1">'fonts/guestlist.svg#guestlist'</code><code class="o">)</code>
      <code class="nt">format</code><code class="o">(</code><code class="s1">'svg'</code><code class="o">),</code>
    <code class="nt">url</code><code class="o">(</code><code class="s1">'fonts/guestlist.woff'</code><code class="o">)</code> <code class="nt">format</code><code class="o">(</code><code class="s1">'woff'</code><code class="o">),</code>
    <code class="nt">url</code><code class="o">(</code><code class="s1">'fonts/guestlist.ttf'</code><code class="o">)</code> <code class="nt">format</code><code class="o">(</code><code class="s1">'truetype'</code><code class="o">);</code>
  <code class="nt">font-weight</code><code class="o">:</code> <code class="nt">normal</code><code class="o">;</code>
  <code class="nt">font-style</code><code class="o">:</code> <code class="nt">normal</code><code class="o">;</code>
<code class="p">}</code>

<code class="o">[</code><code class="nt">class</code><code class="o">^=</code><code class="s2">"icon-check"</code><code class="o">]</code><code class="nd">:before</code><code class="o">,</code>
<code class="o">[</code><code class="nt">class</code><code class="o">*=</code><code class="s2">" icon-check"</code><code class="o">]</code><code class="nd">:before</code> <code class="p">{</code>
  <code class="k">font-family</code><code class="o">:</code> <code class="s1">'guestlist'</code><code class="p">;</code>
  <code class="k">font-style</code><code class="o">:</code> <code class="k">normal</code><code class="p">;</code>
  <code class="k">font-size</code><code class="o">:</code> <code class="m">.75em</code><code class="p">;</code>
  <code class="k">speak</code><code class="o">:</code> <code class="k">none</code><code class="p">;</code>
  <code class="k">font-weight</code><code class="o">:</code> <code class="k">normal</code><code class="p">;</code>
  <code class="o">-</code><code class="n">webkit</code><code class="o">-</code><code class="k">font</code><code class="o">-</code><code class="n">smoothing</code><code class="o">:</code> <code class="n">antialiased</code><code class="p">;</code>
<code class="p">}</code>
<code class="nc">.icon-check</code><code class="nd">:before</code> <code class="p">{</code>
  <code class="k">content</code><code class="o">:</code> <code class="s2">"\e000"</code><code class="p">;</code>
<code class="p">}</code>
<code class="nc">.dropdown-menu</code> <code class="nc">.icon-check</code> <code class="nc">.name</code> <code class="p">{</code>
  <code class="k">padding-left</code><code class="o">:</code> <code class="m">1em</code><code class="p">;</code>
<code class="p">}</code>
</pre></div>
</div>
</div>
</div></section><footer><div class="navfooter">
<hr>
<table style="width: 100%; ">
<tr>
<td style="width: 40%; text-align: left; ">
<a accesskey="p" href="ch04.html">Prev</a> </td>
<td style="width: 20%; text-align: center; "> </td>
<td style="width: 40%; text-align: right; "> <a accesskey="n" href="ch06.html">Next</a>
</td>
</tr>
<tr>
<td style="width: 40%; text-align: left; vertical-align: top; ">Chapter 4. Objects </td>
<td style="width: 20%; text-align: center; "><a accesskey="h" href="index.html">Home</a></td>
<td style="width: 40%; text-align: right; vertical-align: top; "> Chapter 6. Separation of Concerns</td>
</tr>
</table>
</div></footer>


	<div class="extra-footer">
		<p>© 2013, O’Reilly Media, Inc.</p>
		<ul>
			<li><a href="http://oreilly.com/terms/">Terms of Service</a></li>
			<li><a href="http://oreilly.com/oreilly/privacy.csp">Privacy Policy</a></li>
			<li>Interested in <a href="mailto:scordesse@oreilly.com">sponsoring content?</a></li>
		</ul>
	</div>
<script type="text/javascript">if (!NREUMQ.f) { NREUMQ.f=function() {
NREUMQ.push(["load",new Date().getTime()]);
var e=document.createElement("script");
e.type="text/javascript";
e.src=(("http:"===document.location.protocol)?"http:":"https:") + "//" +
  "rpm-images.newrelic.com/42/eum/rum.js";
document.body.appendChild(e);
if(NREUMQ.a)NREUMQ.a();
};
NREUMQ.a=window.onload;window.onload=NREUMQ.f;
};
NREUMQ.push(["nrfj","beacon-3.newrelic.com","3e361aebcf","2194180","IApbRUBZXg1WEEoHDAwORh5aQl8N",14,25,new Date().getTime(),"","","","",""]);</script></body>
</html>