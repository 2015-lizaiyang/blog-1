# 关于“从网页分享到微信”的实现

公司的手机版网站是与微信公众账号配合运营的，有相当大的一部分流量来自微信用户。手机版的商品详情页提供了“分享到微博”功能，那么很自然地，老板希望也可以分享到微信。

在接到这个需求之后，我搜了一下相关资料，针对这个问题做了一些研究，简单小结如下。

## 官方文档

微信开放平台的介绍： <http://open.weixin.qq.com/intro/>

可以看出微信提供了“分享给好友”和“分享到朋友圈”官方接口，效果看起来也很不错。但是，这个接口只适用于 iOS/Android App，并不适用于网页。

除此以外，微信没有公开任何相关资料，也就是说，微信官方没有提供任何从**网页分享到微信**的解决方案。当然这也可以理解，毕竟微信的整个生态都是建立在手机客户端之上的，目前对网页端缺乏支持也是情理之中。

## 民间传说

官方不给力，还是求助于民间高人吧。很快，找到了这篇文章：
[《36氪：如何在网页中添加“分享到朋友圈”按钮》](http://www.36kr.com/p/161946.html)

![36氪的微信分享功能](https://f.cloud.github.com/assets/1231359/673300/e65cb894-d8b2-11e2-9086-cff425d37c83.png)

有图有真相，36氪自己的网站就是这么做的。当用户使用微信浏览网站时，可以使用将当前页面分享至朋友圈。

其中的技术原理可以参考我爱水煮鱼的这篇文章：
[《在微信公众平台前端网页上添加分享到朋友圈、关注微信等按钮》](http://blog.wpjam.com/m/weixinjsbridge/)

简单来说，微信在自己的浏览器（WebView）中埋了一个桥变量 `WeixinJSBridge`，可以实现 WebView 中的 JavaScript 对外层原生应用的功能调用。显然这是一个私有接口，而很多网站利用了这个未公开的桥变量实现了“分享给好友”、“分享到朋友圈”甚至是“关注微信”这样的功能。

既然如此，开工！

## 残酷真相

很快在详情页部署了相关脚本，并且确实可以获取到这个桥变量及其 `.invoke()` 方法，心中不禁一阵窃喜！

![函数源码](https://f.cloud.github.com/assets/1231359/673301/eafc1908-d8b2-11e2-9df2-18a6f74ba821.png)

上面这张图就是 `alert` 出来的 `WeixinJSBridge.invoke()` 方法的源码。虽然是混淆过的，但基本上也可以看得出来它是干什么的。这里遇到一个小坑，`WeixinJSBridge` 对象会在页面加载一段时间之后才会埋入页面，并且其 `.invoke()` 方法也要再等一会儿才会生成。当然这都不算什么，因为更大的坑还在后面。

参照民间高人的示例，试着写了个分享到朋友圈的方法，放到微信里测试，怎么都出不来。

“程序写错了？”“不支持开发环境的假域名？”“人品问题？”

在经历了反复的自我否定和反复的否定自我否定之后，我只好继续搜索答案。果然，有网友反映说，从微信 4.2 版开始，这个 `WeixinJSBridge` 桥变量就不好用了。我一看自己手机上的微信，妈呀，都 4.5 了。

这么说，是微信把原先的“漏洞”给堵上了。好日子到头了，查了一下，果然连 [36氪](http://www.36kr.com/) 自己的新版网站也已经找不到这功能了。

## 退求其次

既然如此，我也就不作梦了，从网页直接分享至微信的功能基本上是不可能实现了。

不过，这并不代表我们不能再做些努力。我发现，微信的浏览器已经整合了分享功能。点击微信浏览器右上角的动作按钮，可以选择各种分享方式和其它操作。既然如此，我们至少还可以提醒用户——“微信也能分享哦”！

![微信分享提示](https://f.cloud.github.com/assets/1231359/673304/f730d948-d8b2-11e2-9242-aed8ad57e80c.png)

至此，这个需求算是告一段落，老板在了解到我的坎坷经历后，对这个结果还是比较满意的。

***

&copy; Creative Commons BY-NC-ND 3.0

&nbsp;
> * [更多文章](https://github.com/cssmagic/blog/issues)
> * [查看原文与评论](https://github.com/cssmagic/blog/issues/7)
